{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/lib/supabase/server.ts"],"sourcesContent":["import { createClient as createSupabaseClient } from \"@supabase/supabase-js\"\r\nimport { createServerClient } from \"@supabase/ssr\"\r\nimport { cookies } from \"next/headers\"\r\n\r\n// -----------------------------------------------------------\r\n// 1. PRIMARY/DEFAULT CLIENT (Safe, Non-Cookie/Non-Session)\r\n// Use this for almost all API calls, especially for CRUD operations \r\n// on non-user data (e.g., fetching Games, Characters, Maps).\r\n// This is your standard, non-crashing client.\r\n// -----------------------------------------------------------\r\n\r\nexport function createClient() {\r\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\r\n  const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY\r\n\r\n  if (!supabaseUrl || !supabaseServiceKey) {\r\n    const anonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\r\n    if (!supabaseUrl || !anonKey) {\r\n      throw new Error(\"Missing Supabase URL and keys\")\r\n    }\r\n    // Note: This falls back to the Anon Key client, which is safe.\r\n    return createSupabaseClient(supabaseUrl, anonKey)\r\n  }\r\n  // This is the powerful Service Role Client\r\n  return createSupabaseClient(supabaseUrl, supabaseServiceKey)\r\n}\r\n\r\n// -----------------------------------------------------------\r\n// 2. SESSION CLIENT (Cookie-Aware)\r\n// Use this ONLY for API calls where you MUST check the user's session \r\n// (e.g., /api/account, /api/auth/logout, or protected server actions).\r\n// -----------------------------------------------------------\r\n\r\nexport const createSessionClient = async () => { // ⬅️ RENAMED for clarity\r\n    const cookieStore = await cookies()\r\n    \r\n    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\r\n    const anonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n\r\n    if (!supabaseUrl || !anonKey) {\r\n        throw new Error(\"Missing Supabase URL or Anon Key for cookie client.\")\r\n    }\r\n\r\n    return createServerClient(\r\n        supabaseUrl,\r\n        anonKey,\r\n        {\r\n            cookies: {\r\n                get: (name: string) => cookieStore.get(name)?.value,\r\n                set: (name: string, value: string, options: any) => {\r\n                    cookieStore.set(name, value, options)\r\n                },\r\n                remove: (name: string, options: any) => {\r\n                    cookieStore.delete(name) \r\n                },\r\n            } as any, \r\n        }\r\n    )\r\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;AAAA;AACA;;;;AASO,SAAS;IACd,MAAM;IACN,MAAM,qBAAqB,QAAQ,GAAG,CAAC,yBAAyB;IAEhE,IAAI,CAAC,eAAe,CAAC,oBAAoB;QACvC,MAAM;QACN;;QAGA,+DAA+D;QAC/D,OAAO,IAAA,yMAAoB,EAAC,aAAa;IAC3C;IACA,2CAA2C;IAC3C,OAAO,IAAA,yMAAoB,EAAC,aAAa;AAC3C;AAQO,MAAM,sBAAsB;IAC/B,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,MAAM;IACN,MAAM;IAEN;;IAIA,OAAO,IAAA,iMAAkB,EACrB,aACA,SACA;QACI,SAAS;YACL,KAAK,CAAC,OAAiB,YAAY,GAAG,CAAC,OAAO;YAC9C,KAAK,CAAC,MAAc,OAAe;gBAC/B,YAAY,GAAG,CAAC,MAAM,OAAO;YACjC;YACA,QAAQ,CAAC,MAAc;gBACnB,YAAY,MAAM,CAAC;YACvB;QACJ;IACJ;AAER"}},
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/app/api/games/%5BgameId%5D/route.ts"],"sourcesContent":["import { createClient } from \"@/lib/supabase/server\";\r\nimport { NextResponse } from \"next/server\";\r\n\r\nexport async function GET(\r\n  req: Request,\r\n  { params }: { params: { gameId?: string | Promise<string> } } // make optional\r\n) {\r\n  let resolvedParams = await params;\r\n  console.log(\"Received params:\", resolvedParams);\r\n  const gameIdStr = resolvedParams.gameId;\r\n  const gameId = Number(gameIdStr);\r\n\r\n  console.log(\"Fetching game with ID:\", gameId);\r\n  console.log(\"Raw gameId parameter:\", gameIdStr);\r\n\r\n  if (!gameIdStr || isNaN(gameId)) {\r\n    return NextResponse.json({ error: \"Invalid game ID\" }, { status: 400 });\r\n  }\r\n\r\n  const supabase = await createClient();\r\n\r\n  const { data, error } = await supabase\r\n    .from(\"games\")\r\n    .select(`\r\n      *,\r\n      games_characters(ingamecharacters(*)),\r\n      maps(*),\r\n      mobs(*),\r\n      storyarcs(*),\r\n      games_contributors(contributors(*))\r\n    `)\r\n    .eq(\"gameid\", gameId)\r\n    .single();\r\n\r\n  if (error || !data) {\r\n    return NextResponse.json({ error: error?.message || \"Game not found\" }, { status: 404 });\r\n  }\r\n\r\n  return NextResponse.json(data);\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IACpB,GAAY,EACZ,EAAE,MAAM,EAAqD,CAAC,gBAAgB;AAAjB;IAE7D,IAAI,iBAAiB,MAAM;IAC3B,QAAQ,GAAG,CAAC,oBAAoB;IAChC,MAAM,YAAY,eAAe,MAAM;IACvC,MAAM,SAAS,OAAO;IAEtB,QAAQ,GAAG,CAAC,0BAA0B;IACtC,QAAQ,GAAG,CAAC,yBAAyB;IAErC,IAAI,CAAC,aAAa,MAAM,SAAS;QAC/B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAkB,GAAG;YAAE,QAAQ;QAAI;IACvE;IAEA,MAAM,WAAW,MAAM,IAAA,2IAAY;IAEnC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,SACL,MAAM,CAAC,CAAC;;;;;;;IAOT,CAAC,EACA,EAAE,CAAC,UAAU,QACb,MAAM;IAET,IAAI,SAAS,CAAC,MAAM;QAClB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,OAAO,WAAW;QAAiB,GAAG;YAAE,QAAQ;QAAI;IACxF;IAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;AAC3B"}}]
}