{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/lib/supabase/server.ts"],"sourcesContent":["import { createClient as createSupabaseClient } from \"@supabase/supabase-js\"\r\n\r\nexport async function createClient() {\r\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\r\n  const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY\r\n\r\n  if (!supabaseUrl || !supabaseServiceKey) {\r\n    const anonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\r\n    if (!supabaseUrl || !anonKey) {\r\n      throw new Error(\"Missing Supabase URL and keys\")\r\n    }\r\n    return createSupabaseClient(supabaseUrl, anonKey)\r\n  }\r\n\r\n  return createSupabaseClient(supabaseUrl, supabaseServiceKey)\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe;IACpB,MAAM,cAAc,QAAQ,GAAG,CAAC,wBAAwB;IACxD,MAAM,qBAAqB,QAAQ,GAAG,CAAC,yBAAyB;IAEhE,IAAI,CAAC,eAAe,CAAC,oBAAoB;QACvC,MAAM,UAAU,QAAQ,GAAG,CAAC,6BAA6B;QACzD,IAAI,CAAC,eAAe,CAAC,SAAS;YAC5B,MAAM,IAAI,MAAM;QAClB;QACA,OAAO,IAAA,yMAAoB,EAAC,aAAa;IAC3C;IAEA,OAAO,IAAA,yMAAoB,EAAC,aAAa;AAC3C"}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/app/api/games/%5BgameId%5D/route.ts"],"sourcesContent":["import { createClient } from \"@/lib/supabase/server\"\r\nimport { NextRequest, NextResponse } from \"next/server\"\r\n\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: { gameId: string } }\r\n) {\r\n  const supabase = await createClient()\r\n  const gameId = Number(params.gameId)\r\n  console.log(\"[API] requested gameID:\", gameId)\r\n\r\n  try {\r\n    // 1️⃣ fetch main game first\r\n    const { data: game, error: gameError } = await supabase\r\n      .from(\"games\")\r\n      .select(\"*\")\r\n      .eq(\"gameid\", gameId)\r\n      .single()\r\n\r\n    if (gameError || !game) {\r\n      console.error(\"[API] game not found:\", gameError)\r\n      return NextResponse.json({ error: \"Game not found\" }, { status: 404 })\r\n    }\r\n\r\n    // 2️⃣ fetch related tables safely\r\n    const [\r\n      { data: charactersRaw },\r\n      { data: mapsRaw },\r\n      { data: mobsRaw },\r\n      { data: arcsRaw },\r\n      { data: contributorsRaw },\r\n    ] = await Promise.all([\r\n      supabase\r\n        .from(\"games_characters\")\r\n        .select(`\r\n          characterid,\r\n          ingamecharacters (\r\n            characterName,\r\n            backstory,\r\n            englishVA,\r\n            japaneseVA,\r\n            motionCapture,\r\n            description,\r\n            spriteURL\r\n          )\r\n        `)\r\n        .eq(\"gameid\", gameId)\r\n        .maybeSingle(), // ensures null instead of throwing\r\n      supabase\r\n        .from(\"maps\")\r\n        .select(`\r\n          mapid,\r\n          mapname,\r\n          floorname,\r\n          description,\r\n          mapurl\r\n        `)\r\n        .eq(\"gameid\", gameId),\r\n      supabase\r\n        .from(\"mobs\")\r\n        .select(`\r\n          mobid,\r\n          mobname,\r\n          mobtype,\r\n          description,\r\n          weakness,\r\n          mobspriteurl,\r\n          spawnnotes\r\n        `)\r\n        .eq(\"gameid\", gameId),\r\n      supabase\r\n        .from(\"storyarcs\")\r\n        .select(`\r\n          storyarcid,\r\n          parentarcid,\r\n          arctitle,\r\n          arcorder,\r\n          summary,\r\n          description,\r\n          ismainarc\r\n        `)\r\n        .eq(\"gameid\", gameId),\r\n      supabase\r\n        .from(\"games_contributors\")\r\n        .select(`\r\n          contributorid,\r\n          roleid,\r\n          contributors (\r\n            contributorName,\r\n            specialization\r\n          ),\r\n          roles (\r\n            roleName\r\n          )\r\n        `)\r\n        .eq(\"gameid\", gameId),\r\n    ])\r\n\r\n    // 3️⃣ map characters safely\r\n    const characters = (charactersRaw ? [charactersRaw] : []).map((c: any) => ({\r\n      characterID: c.characterid,\r\n      characterName: c.ingamecharacters?.characterName || \"Unknown\",\r\n      backstory: c.ingamecharacters?.backstory || \"\",\r\n    }))\r\n\r\n    // 4️⃣ map contributors safely\r\n    const contributors = (contributorsRaw || []).map((c: any) => ({\r\n      contributorID: c.contributorid,\r\n      contributorName: c.contributors?.contributorName || \"Unknown\",\r\n      specialization: c.contributors?.specialization || \"\",\r\n      role: c.roles?.roleName || \"\",\r\n    }))\r\n\r\n    // 5️⃣ return safe JSON\r\n    return NextResponse.json(\r\n      {\r\n        gameID: game.gameid,\r\n        title: game.title,\r\n        plotSummary: game.plotsummary || \"\",\r\n        releaseDate: game.releasedate,\r\n        gameCoverURL: game.gamecoverurl || \"\",\r\n        gameLogoURL: game.gamelogourl || \"\",\r\n        multiplayerSupport: game.multiplayersupport || false,\r\n        characters,\r\n        maps: mapsRaw || [],\r\n        mobs: mobsRaw || [],\r\n        storyArcs: arcsRaw || [],\r\n        contributors,\r\n      },\r\n      { status: 200 }\r\n    )\r\n  } catch (error) {\r\n    console.error(\"[API] Failed to fetch game details:\", error)\r\n    return NextResponse.json(\r\n      { error: \"Failed to fetch game details\" },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IACpB,OAAoB,EACpB,EAAE,MAAM,EAAkC;IAE1C,MAAM,WAAW,MAAM,IAAA,2IAAY;IACnC,MAAM,SAAS,OAAO,OAAO,MAAM;IACnC,QAAQ,GAAG,CAAC,2BAA2B;IAEvC,IAAI;QACF,4BAA4B;QAC5B,MAAM,EAAE,MAAM,IAAI,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,SAC5C,IAAI,CAAC,SACL,MAAM,CAAC,KACP,EAAE,CAAC,UAAU,QACb,MAAM;QAET,IAAI,aAAa,CAAC,MAAM;YACtB,QAAQ,KAAK,CAAC,yBAAyB;YACvC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACtE;QAEA,kCAAkC;QAClC,MAAM,CACJ,EAAE,MAAM,aAAa,EAAE,EACvB,EAAE,MAAM,OAAO,EAAE,EACjB,EAAE,MAAM,OAAO,EAAE,EACjB,EAAE,MAAM,OAAO,EAAE,EACjB,EAAE,MAAM,eAAe,EAAE,CAC1B,GAAG,MAAM,QAAQ,GAAG,CAAC;YACpB,SACG,IAAI,CAAC,oBACL,MAAM,CAAC,CAAC;;;;;;;;;;;QAWT,CAAC,EACA,EAAE,CAAC,UAAU,QACb,WAAW;YACd,SACG,IAAI,CAAC,QACL,MAAM,CAAC,CAAC;;;;;;QAMT,CAAC,EACA,EAAE,CAAC,UAAU;YAChB,SACG,IAAI,CAAC,QACL,MAAM,CAAC,CAAC;;;;;;;;QAQT,CAAC,EACA,EAAE,CAAC,UAAU;YAChB,SACG,IAAI,CAAC,aACL,MAAM,CAAC,CAAC;;;;;;;;QAQT,CAAC,EACA,EAAE,CAAC,UAAU;YAChB,SACG,IAAI,CAAC,sBACL,MAAM,CAAC,CAAC;;;;;;;;;;QAUT,CAAC,EACA,EAAE,CAAC,UAAU;SACjB;QAED,4BAA4B;QAC5B,MAAM,aAAa,CAAC,gBAAgB;YAAC;SAAc,GAAG,EAAE,EAAE,GAAG,CAAC,CAAC,IAAW,CAAC;gBACzE,aAAa,EAAE,WAAW;gBAC1B,eAAe,EAAE,gBAAgB,EAAE,iBAAiB;gBACpD,WAAW,EAAE,gBAAgB,EAAE,aAAa;YAC9C,CAAC;QAED,8BAA8B;QAC9B,MAAM,eAAe,CAAC,mBAAmB,EAAE,EAAE,GAAG,CAAC,CAAC,IAAW,CAAC;gBAC5D,eAAe,EAAE,aAAa;gBAC9B,iBAAiB,EAAE,YAAY,EAAE,mBAAmB;gBACpD,gBAAgB,EAAE,YAAY,EAAE,kBAAkB;gBAClD,MAAM,EAAE,KAAK,EAAE,YAAY;YAC7B,CAAC;QAED,uBAAuB;QACvB,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,QAAQ,KAAK,MAAM;YACnB,OAAO,KAAK,KAAK;YACjB,aAAa,KAAK,WAAW,IAAI;YACjC,aAAa,KAAK,WAAW;YAC7B,cAAc,KAAK,YAAY,IAAI;YACnC,aAAa,KAAK,WAAW,IAAI;YACjC,oBAAoB,KAAK,kBAAkB,IAAI;YAC/C;YACA,MAAM,WAAW,EAAE;YACnB,MAAM,WAAW,EAAE;YACnB,WAAW,WAAW,EAAE;YACxB;QACF,GACA;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uCAAuC;QACrD,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA+B,GACxC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}