{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/node_modules/next-video/dist/video-handler.js"],"sourcesContent":["const HANDLERS = {};\nconst DEFAULT_HANDLER_CONFIG = {\n  provider: \"mux\"\n};\nasync function callHandler(event, data, config = {}) {\n  const mergedConfig = { ...DEFAULT_HANDLER_CONFIG, ...config };\n  const handler = HANDLERS[event];\n  if (!handler) {\n    return;\n  }\n  return handler(data, mergedConfig);\n}\nfunction videoHandler(event, callback) {\n  HANDLERS[event] = callback;\n  return async (event2) => callback(event2);\n}\nexport {\n  HANDLERS,\n  callHandler,\n  videoHandler\n};\n"],"names":[],"mappings":";;;;;;;;AAAA,MAAM,WAAW,CAAC;AAClB,MAAM,yBAAyB;IAC7B,UAAU;AACZ;AACA,eAAe,YAAY,KAAK,EAAE,IAAI,EAAE,SAAS,CAAC,CAAC;IACjD,MAAM,eAAe;QAAE,GAAG,sBAAsB;QAAE,GAAG,MAAM;IAAC;IAC5D,MAAM,UAAU,QAAQ,CAAC,MAAM;IAC/B,IAAI,CAAC,SAAS;QACZ;IACF;IACA,OAAO,QAAQ,MAAM;AACvB;AACA,SAAS,aAAa,KAAK,EAAE,QAAQ;IACnC,QAAQ,CAAC,MAAM,GAAG;IAClB,OAAO,OAAO,SAAW,SAAS;AACpC","ignoreList":[0]}},
    {"offset": {"line": 36, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/node_modules/next-video/dist/config.js"],"sourcesContent":["import path from \"node:path\";\nimport { mkdir, readFile, writeFile } from \"node:fs/promises\";\nimport { cwd } from \"node:process\";\nconst videoConfigDefault = {\n  folder: \"videos\",\n  path: \"/api/video\",\n  provider: \"mux\",\n  providerConfig: {},\n  loadAsset: async function(assetPath) {\n    const file = await readFile(assetPath);\n    const asset = JSON.parse(file.toString());\n    return asset;\n  },\n  saveAsset: async function(assetPath, asset) {\n    try {\n      await mkdir(path.dirname(assetPath), { recursive: true });\n      await writeFile(assetPath, JSON.stringify(asset), {\n        flag: \"wx\"\n      });\n    } catch (err) {\n      if (err.code === \"EEXIST\") {\n        return;\n      }\n      throw err;\n    }\n  },\n  updateAsset: async function(assetPath, asset) {\n    await writeFile(assetPath, JSON.stringify(asset));\n  }\n};\nglobalThis.__nextVideo = {\n  configComplete: videoConfigDefault,\n  configIsDefined: false\n};\nfunction setVideoConfig(videoConfig) {\n  globalThis.__nextVideo.configIsDefined = true;\n  globalThis.__nextVideo.configComplete = { ...videoConfigDefault, ...videoConfig };\n  return globalThis.__nextVideo.configComplete;\n}\nasync function getVideoConfig() {\n  if (!globalThis.__nextVideo.configIsDefined) {\n    try {\n      const nextConfigModule = (await import(\n        /* webpackIgnore: true */\n        \"next/dist/server/config.js\"\n      )).default;\n      const loadNextConfig = nextConfigModule.default ?? nextConfigModule;\n      await loadNextConfig(\"phase-development-server\", cwd());\n    } catch (err) {\n      console.error(err);\n    }\n  }\n  return globalThis.__nextVideo.configComplete;\n}\nexport {\n  getVideoConfig,\n  setVideoConfig,\n  videoConfigDefault\n};\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;;;;AACA,MAAM,qBAAqB;IACzB,QAAQ;IACR,MAAM;IACN,UAAU;IACV,gBAAgB,CAAC;IACjB,WAAW,eAAe,SAAS;QACjC,MAAM,OAAO,MAAM,IAAA,iJAAQ,EAAC;QAC5B,MAAM,QAAQ,KAAK,KAAK,CAAC,KAAK,QAAQ;QACtC,OAAO;IACT;IACA,WAAW,eAAe,SAAS,EAAE,KAAK;QACxC,IAAI;YACF,MAAM,IAAA,8IAAK,EAAC,4HAAI,CAAC,OAAO,CAAC,YAAY;gBAAE,WAAW;YAAK;YACvD,MAAM,IAAA,kJAAS,EAAC,WAAW,KAAK,SAAS,CAAC,QAAQ;gBAChD,MAAM;YACR;QACF,EAAE,OAAO,KAAK;YACZ,IAAI,IAAI,IAAI,KAAK,UAAU;gBACzB;YACF;YACA,MAAM;QACR;IACF;IACA,aAAa,eAAe,SAAS,EAAE,KAAK;QAC1C,MAAM,IAAA,kJAAS,EAAC,WAAW,KAAK,SAAS,CAAC;IAC5C;AACF;AACA,WAAW,WAAW,GAAG;IACvB,gBAAgB;IAChB,iBAAiB;AACnB;AACA,SAAS,eAAe,WAAW;IACjC,WAAW,WAAW,CAAC,eAAe,GAAG;IACzC,WAAW,WAAW,CAAC,cAAc,GAAG;QAAE,GAAG,kBAAkB;QAAE,GAAG,WAAW;IAAC;IAChF,OAAO,WAAW,WAAW,CAAC,cAAc;AAC9C;AACA,eAAe;IACb,IAAI,CAAC,WAAW,WAAW,CAAC,eAAe,EAAE;QAC3C,IAAI;YACF,MAAM,mBAAmB,CAAC,MAAM,MAAM,CACpC,uBAAuB,GACvB,6BACD,EAAE,OAAO;YACV,MAAM,iBAAiB,iBAAiB,OAAO,IAAI;YACnD,MAAM,eAAe,4BAA4B,IAAA,8HAAG;QACtD,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC;QAChB;IACF;IACA,OAAO,WAAW,WAAW,CAAC,cAAc;AAC9C","ignoreList":[0]}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/node_modules/next-video/dist/utils/utils.js"],"sourcesContent":["import fs from \"node:fs\";\nimport resolve from \"resolve\";\nfunction getPackageVersion(packageName) {\n  const packageJsonPath = resolvePackageJson(packageName);\n  if (packageJsonPath) {\n    try {\n      const packageJson = JSON.parse(\n        fs.readFileSync(packageJsonPath, { encoding: \"utf-8\" })\n      );\n      return packageJson.version;\n    } catch {\n    }\n  }\n  return void 0;\n}\nfunction resolvePackageJson(packageName) {\n  try {\n    return resolve.sync(`${packageName}/package.json`, {\n      basedir: process.cwd(),\n      preserveSymlinks: true\n    });\n  } catch {\n    return void 0;\n  }\n}\nfunction sleep(ms) {\n  return new Promise((resolve2) => setTimeout(resolve2, ms));\n}\nfunction camelCase(name) {\n  return name.replace(/[-_]([a-z])/g, ($0, $1) => $1.toUpperCase());\n}\nfunction isRemote(filePath) {\n  return /^https?:\\/\\//.test(filePath);\n}\nfunction toSafePath(str) {\n  return str.replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g, \"\").replace(/[^a-zA-Z0-9._-]+/g, \"_\");\n}\nfunction deepMerge(...objects) {\n  const result = {};\n  for (const obj of objects) {\n    for (const key in obj) {\n      const existing = result[key];\n      const val = obj[key];\n      if (Array.isArray(val) && Array.isArray(existing)) {\n        result[key] = existing.concat(...val);\n      } else if (isObject(val) && isObject(existing)) {\n        result[key] = deepMerge(existing, val);\n      } else {\n        result[key] = val;\n      }\n    }\n  }\n  return result;\n}\nfunction isObject(item) {\n  return item && typeof item === \"object\" && !Array.isArray(item);\n}\nexport {\n  camelCase,\n  deepMerge,\n  getPackageVersion,\n  isObject,\n  isRemote,\n  sleep,\n  toSafePath\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;AACA;;;AACA,SAAS,kBAAkB,WAAW;IACpC,MAAM,kBAAkB,mBAAmB;IAC3C,IAAI,iBAAiB;QACnB,IAAI;YACF,MAAM,cAAc,KAAK,KAAK,CAC5B,wHAAE,CAAC,YAAY,CAAC,iBAAiB;gBAAE,UAAU;YAAQ;YAEvD,OAAO,YAAY,OAAO;QAC5B,EAAE,OAAM,CACR;IACF;IACA,OAAO,KAAK;AACd;AACA,SAAS,mBAAmB,WAAW;IACrC,IAAI;QACF,OAAO,6IAAO,CAAC,IAAI,CAAC,GAAG,YAAY,aAAa,CAAC,EAAE;YACjD,SAAS,QAAQ,GAAG;YACpB,kBAAkB;QACpB;IACF,EAAE,OAAM;QACN,OAAO,KAAK;IACd;AACF;AACA,SAAS,MAAM,EAAE;IACf,OAAO,IAAI,QAAQ,CAAC,WAAa,WAAW,UAAU;AACxD;AACA,SAAS,UAAU,IAAI;IACrB,OAAO,KAAK,OAAO,CAAC,gBAAgB,CAAC,IAAI,KAAO,GAAG,WAAW;AAChE;AACA,SAAS,SAAS,QAAQ;IACxB,OAAO,eAAe,IAAI,CAAC;AAC7B;AACA,SAAS,WAAW,GAAG;IACrB,OAAO,IAAI,OAAO,CAAC,kCAAkC,IAAI,OAAO,CAAC,qBAAqB;AACxF;AACA,SAAS,UAAU,GAAG,OAAO;IAC3B,MAAM,SAAS,CAAC;IAChB,KAAK,MAAM,OAAO,QAAS;QACzB,IAAK,MAAM,OAAO,IAAK;YACrB,MAAM,WAAW,MAAM,CAAC,IAAI;YAC5B,MAAM,MAAM,GAAG,CAAC,IAAI;YACpB,IAAI,MAAM,OAAO,CAAC,QAAQ,MAAM,OAAO,CAAC,WAAW;gBACjD,MAAM,CAAC,IAAI,GAAG,SAAS,MAAM,IAAI;YACnC,OAAO,IAAI,SAAS,QAAQ,SAAS,WAAW;gBAC9C,MAAM,CAAC,IAAI,GAAG,UAAU,UAAU;YACpC,OAAO;gBACL,MAAM,CAAC,IAAI,GAAG;YAChB;QACF;IACF;IACA,OAAO;AACT;AACA,SAAS,SAAS,IAAI;IACpB,OAAO,QAAQ,OAAO,SAAS,YAAY,CAAC,MAAM,OAAO,CAAC;AAC5D","ignoreList":[0]}},
    {"offset": {"line": 187, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/node_modules/next-video/dist/providers/mux/transformer.js"],"sourcesContent":["const MUX_VIDEO_DOMAIN = \"mux.com\";\nfunction transform(asset, props) {\n  const playbackId = getPlaybackId(asset);\n  if (!playbackId) return asset;\n  const thumbnailTime = asset.providerMetadata?.mux?.thumbnailTime ?? props?.thumbnailTime ?? props?.startTime;\n  const transformedAsset = {\n    ...asset,\n    sources: [{\n      src: `https://stream.${props?.customDomain ?? MUX_VIDEO_DOMAIN}/${playbackId}.m3u8`,\n      type: \"application/x-mpegURL\"\n    }],\n    poster: getPosterURLFromPlaybackId(playbackId, {\n      thumbnailTime,\n      customDomain: props?.customDomain,\n      token: props?.tokens?.thumbnail\n    })\n  };\n  if (thumbnailTime >= 0) {\n    transformedAsset.thumbnailTime = thumbnailTime;\n  }\n  return transformedAsset;\n}\nfunction getPlaybackId(asset) {\n  const providerMetadata = asset.providerMetadata?.mux ?? asset.externalIds;\n  return providerMetadata?.playbackId;\n}\nconst getPosterURLFromPlaybackId = (playbackId, { token, thumbnailTime, width, customDomain = MUX_VIDEO_DOMAIN } = {}) => {\n  const time = token == null ? thumbnailTime : void 0;\n  const { aud } = parseJwt(token);\n  if (token && aud !== \"t\") {\n    return;\n  }\n  return `https://image.${customDomain}/${playbackId}/thumbnail.webp${toQuery({\n    token,\n    time,\n    width\n  })}`;\n};\nfunction toQuery(obj) {\n  const params = toParams(obj).toString();\n  return params ? \"?\" + params : \"\";\n}\nfunction toParams(obj) {\n  const params = {};\n  for (const key in obj) {\n    if (obj[key] != null) params[key] = obj[key];\n  }\n  return new URLSearchParams(params);\n}\nfunction parseJwt(token) {\n  const base64Url = (token ?? \"\").split(\".\")[1];\n  if (!base64Url) return {};\n  const base64 = base64Url.replace(/-/g, \"+\").replace(/_/g, \"/\");\n  const jsonPayload = decodeURIComponent(\n    atob(base64).split(\"\").map(function(c) {\n      return \"%\" + (\"00\" + c.charCodeAt(0).toString(16)).slice(-2);\n    }).join(\"\")\n  );\n  return JSON.parse(jsonPayload);\n}\nexport {\n  getPlaybackId,\n  getPosterURLFromPlaybackId,\n  transform\n};\n"],"names":[],"mappings":";;;;;;;;AAAA,MAAM,mBAAmB;AACzB,SAAS,UAAU,KAAK,EAAE,KAAK;IAC7B,MAAM,aAAa,cAAc;IACjC,IAAI,CAAC,YAAY,OAAO;IACxB,MAAM,gBAAgB,MAAM,gBAAgB,EAAE,KAAK,iBAAiB,OAAO,iBAAiB,OAAO;IACnG,MAAM,mBAAmB;QACvB,GAAG,KAAK;QACR,SAAS;YAAC;gBACR,KAAK,CAAC,eAAe,EAAE,OAAO,gBAAgB,iBAAiB,CAAC,EAAE,WAAW,KAAK,CAAC;gBACnF,MAAM;YACR;SAAE;QACF,QAAQ,2BAA2B,YAAY;YAC7C;YACA,cAAc,OAAO;YACrB,OAAO,OAAO,QAAQ;QACxB;IACF;IACA,IAAI,iBAAiB,GAAG;QACtB,iBAAiB,aAAa,GAAG;IACnC;IACA,OAAO;AACT;AACA,SAAS,cAAc,KAAK;IAC1B,MAAM,mBAAmB,MAAM,gBAAgB,EAAE,OAAO,MAAM,WAAW;IACzE,OAAO,kBAAkB;AAC3B;AACA,MAAM,6BAA6B,CAAC,YAAY,EAAE,KAAK,EAAE,aAAa,EAAE,KAAK,EAAE,eAAe,gBAAgB,EAAE,GAAG,CAAC,CAAC;IACnH,MAAM,OAAO,SAAS,OAAO,gBAAgB,KAAK;IAClD,MAAM,EAAE,GAAG,EAAE,GAAG,SAAS;IACzB,IAAI,SAAS,QAAQ,KAAK;QACxB;IACF;IACA,OAAO,CAAC,cAAc,EAAE,aAAa,CAAC,EAAE,WAAW,eAAe,EAAE,QAAQ;QAC1E;QACA;QACA;IACF,IAAI;AACN;AACA,SAAS,QAAQ,GAAG;IAClB,MAAM,SAAS,SAAS,KAAK,QAAQ;IACrC,OAAO,SAAS,MAAM,SAAS;AACjC;AACA,SAAS,SAAS,GAAG;IACnB,MAAM,SAAS,CAAC;IAChB,IAAK,MAAM,OAAO,IAAK;QACrB,IAAI,GAAG,CAAC,IAAI,IAAI,MAAM,MAAM,CAAC,IAAI,GAAG,GAAG,CAAC,IAAI;IAC9C;IACA,OAAO,IAAI,gBAAgB;AAC7B;AACA,SAAS,SAAS,KAAK;IACrB,MAAM,YAAY,CAAC,SAAS,EAAE,EAAE,KAAK,CAAC,IAAI,CAAC,EAAE;IAC7C,IAAI,CAAC,WAAW,OAAO,CAAC;IACxB,MAAM,SAAS,UAAU,OAAO,CAAC,MAAM,KAAK,OAAO,CAAC,MAAM;IAC1D,MAAM,cAAc,mBAClB,KAAK,QAAQ,KAAK,CAAC,IAAI,GAAG,CAAC,SAAS,CAAC;QACnC,OAAO,MAAM,CAAC,OAAO,EAAE,UAAU,CAAC,GAAG,QAAQ,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;IAC5D,GAAG,IAAI,CAAC;IAEV,OAAO,KAAK,KAAK,CAAC;AACpB","ignoreList":[0]}},
    {"offset": {"line": 260, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/node_modules/next-video/dist/providers/vercel-blob/transformer.js"],"sourcesContent":["function transform(asset) {\n  const providerDetails = asset.providerMetadata?.[\"vercel-blob\"] ?? asset.externalIds;\n  if (!providerDetails) return asset;\n  const source = {\n    src: providerDetails.url\n  };\n  if (providerDetails.contentType) {\n    source.type = providerDetails.contentType;\n  }\n  return {\n    ...asset,\n    sources: [source]\n  };\n}\nexport {\n  transform\n};\n"],"names":[],"mappings":";;;;AAAA,SAAS,UAAU,KAAK;IACtB,MAAM,kBAAkB,MAAM,gBAAgB,EAAE,CAAC,cAAc,IAAI,MAAM,WAAW;IACpF,IAAI,CAAC,iBAAiB,OAAO;IAC7B,MAAM,SAAS;QACb,KAAK,gBAAgB,GAAG;IAC1B;IACA,IAAI,gBAAgB,WAAW,EAAE;QAC/B,OAAO,IAAI,GAAG,gBAAgB,WAAW;IAC3C;IACA,OAAO;QACL,GAAG,KAAK;QACR,SAAS;YAAC;SAAO;IACnB;AACF","ignoreList":[0]}},
    {"offset": {"line": 285, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/node_modules/next-video/dist/providers/backblaze/transformer.js"],"sourcesContent":["function transform(asset) {\n  const providerMetadata = asset.providerMetadata?.backblaze;\n  if (!providerMetadata) return asset;\n  const src = new URL(providerMetadata.endpoint);\n  src.hostname = `${providerMetadata.bucket}.${src.hostname}`;\n  src.pathname = providerMetadata.key;\n  const source = { src: `${src}` };\n  return {\n    ...asset,\n    sources: [source]\n  };\n}\nexport {\n  transform\n};\n"],"names":[],"mappings":";;;;AAAA,SAAS,UAAU,KAAK;IACtB,MAAM,mBAAmB,MAAM,gBAAgB,EAAE;IACjD,IAAI,CAAC,kBAAkB,OAAO;IAC9B,MAAM,MAAM,IAAI,IAAI,iBAAiB,QAAQ;IAC7C,IAAI,QAAQ,GAAG,GAAG,iBAAiB,MAAM,CAAC,CAAC,EAAE,IAAI,QAAQ,EAAE;IAC3D,IAAI,QAAQ,GAAG,iBAAiB,GAAG;IACnC,MAAM,SAAS;QAAE,KAAK,GAAG,KAAK;IAAC;IAC/B,OAAO;QACL,GAAG,KAAK;QACR,SAAS;YAAC;SAAO;IACnB;AACF","ignoreList":[0]}},
    {"offset": {"line": 310, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/node_modules/next-video/dist/providers/amazon-s3/transformer.js"],"sourcesContent":["function transform(asset) {\n  const providerMetadata = asset.providerMetadata?.[\"amazon-s3\"];\n  if (!providerMetadata) return asset;\n  const src = new URL(providerMetadata.endpoint);\n  src.hostname = `${providerMetadata.bucket}.${src.hostname}`;\n  src.pathname = providerMetadata.key;\n  const source = { src: `${src}` };\n  return {\n    ...asset,\n    sources: [source]\n  };\n}\nexport {\n  transform\n};\n"],"names":[],"mappings":";;;;AAAA,SAAS,UAAU,KAAK;IACtB,MAAM,mBAAmB,MAAM,gBAAgB,EAAE,CAAC,YAAY;IAC9D,IAAI,CAAC,kBAAkB,OAAO;IAC9B,MAAM,MAAM,IAAI,IAAI,iBAAiB,QAAQ;IAC7C,IAAI,QAAQ,GAAG,GAAG,iBAAiB,MAAM,CAAC,CAAC,EAAE,IAAI,QAAQ,EAAE;IAC3D,IAAI,QAAQ,GAAG,iBAAiB,GAAG;IACnC,MAAM,SAAS;QAAE,KAAK,GAAG,KAAK;IAAC;IAC/B,OAAO;QACL,GAAG,KAAK;QACR,SAAS;YAAC;SAAO;IACnB;AACF","ignoreList":[0]}},
    {"offset": {"line": 335, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/node_modules/next-video/dist/providers/cloudflare-r2/transformer.js"],"sourcesContent":["function transform(asset) {\n  const providerMetadata = asset.providerMetadata?.[\"cloudflare-r2\"];\n  if (!providerMetadata) return asset;\n  const src = new URL(providerMetadata.bucketUrlPublic);\n  src.pathname = providerMetadata.key;\n  const source = { src: `${src}` };\n  return {\n    ...asset,\n    sources: [source]\n  };\n}\nexport {\n  transform\n};\n"],"names":[],"mappings":";;;;AAAA,SAAS,UAAU,KAAK;IACtB,MAAM,mBAAmB,MAAM,gBAAgB,EAAE,CAAC,gBAAgB;IAClE,IAAI,CAAC,kBAAkB,OAAO;IAC9B,MAAM,MAAM,IAAI,IAAI,iBAAiB,eAAe;IACpD,IAAI,QAAQ,GAAG,iBAAiB,GAAG;IACnC,MAAM,SAAS;QAAE,KAAK,GAAG,KAAK;IAAC;IAC/B,OAAO;QACL,GAAG,KAAK;QACR,SAAS;YAAC;SAAO;IACnB;AACF","ignoreList":[0]}},
    {"offset": {"line": 359, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/node_modules/next-video/dist/providers/transformers.js"],"sourcesContent":["import * as mux from \"./mux/transformer.js\";\nimport * as vercelBlob from \"./vercel-blob/transformer.js\";\nimport * as backblaze from \"./backblaze/transformer.js\";\nimport * as amazonS3 from \"./amazon-s3/transformer.js\";\nimport * as cloudflareR2 from \"./cloudflare-r2/transformer.js\";\nexport {\n  amazonS3,\n  backblaze,\n  cloudflareR2,\n  mux,\n  vercelBlob\n};\n"],"names":[],"mappings":";AAAA;AACA;AACA;AACA;AACA","ignoreList":[0]}},
    {"offset": {"line": 397, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/node_modules/next-video/dist/assets.js"],"sourcesContent":["import * as path from \"node:path\";\nimport { cwd } from \"node:process\";\nimport { stat } from \"node:fs/promises\";\nimport { getVideoConfig } from \"./config.js\";\nimport { deepMerge, camelCase, isRemote, toSafePath } from \"./utils/utils.js\";\nimport * as transformers from \"./providers/transformers.js\";\nasync function getAsset(filePath) {\n  const videoConfig = await getVideoConfig();\n  const assetConfigPath = await getAssetConfigPath(filePath);\n  return videoConfig.loadAsset(assetConfigPath);\n}\nasync function getAssetConfigPath(filePath) {\n  return `${await getAssetPath(filePath)}.json`;\n}\nasync function getAssetPath(filePath) {\n  if (!isRemote(filePath)) return filePath;\n  const { folder, remoteSourceAssetPath = defaultRemoteSourceAssetPath } = await getVideoConfig();\n  if (!folder) throw new Error(\"Missing video `folder` config.\");\n  return path.join(folder, remoteSourceAssetPath(filePath));\n}\nfunction defaultRemoteSourceAssetPath(url) {\n  const urlObj = new URL(url);\n  return toSafePath(decodeURIComponent(`${urlObj.hostname}${urlObj.pathname}`));\n}\nasync function createAsset(filePath, assetDetails) {\n  const videoConfig = await getVideoConfig();\n  const assetConfigPath = await getAssetConfigPath(filePath);\n  let originalFilePath = filePath;\n  if (!isRemote(filePath)) {\n    originalFilePath = path.relative(cwd(), filePath);\n  }\n  const newAssetDetails = {\n    status: \"pending\",\n    // overwritable\n    ...assetDetails,\n    originalFilePath,\n    provider: videoConfig.provider,\n    providerMetadata: {},\n    createdAt: Date.now(),\n    updatedAt: Date.now()\n  };\n  if (!isRemote(filePath)) {\n    try {\n      newAssetDetails.size = (await stat(filePath))?.size;\n    } catch {\n    }\n  }\n  await videoConfig.saveAsset(assetConfigPath, newAssetDetails);\n  return newAssetDetails;\n}\nasync function updateAsset(filePath, assetDetails) {\n  const videoConfig = await getVideoConfig();\n  const assetConfigPath = await getAssetConfigPath(filePath);\n  const currentAsset = await getAsset(filePath);\n  if (!currentAsset) {\n    throw new Error(`Asset not found: ${filePath}`);\n  }\n  let newAssetDetails = deepMerge(currentAsset, assetDetails, {\n    updatedAt: Date.now()\n  });\n  newAssetDetails = transformAsset(transformers, newAssetDetails);\n  await videoConfig.updateAsset(assetConfigPath, newAssetDetails);\n  return newAssetDetails;\n}\nfunction transformAsset(transformers2, asset) {\n  const provider = asset.provider;\n  if (!provider) return asset;\n  for (let [key, transformer] of Object.entries(transformers2)) {\n    if (key === camelCase(provider)) {\n      return transformer.transform(asset);\n    }\n  }\n  return asset;\n}\nexport {\n  createAsset,\n  getAsset,\n  getAssetConfigPath,\n  updateAsset\n};\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;;;;;;;AACA,eAAe,SAAS,QAAQ;IAC9B,MAAM,cAAc,MAAM,IAAA,mKAAc;IACxC,MAAM,kBAAkB,MAAM,mBAAmB;IACjD,OAAO,YAAY,SAAS,CAAC;AAC/B;AACA,eAAe,mBAAmB,QAAQ;IACxC,OAAO,GAAG,MAAM,aAAa,UAAU,KAAK,CAAC;AAC/C;AACA,eAAe,aAAa,QAAQ;IAClC,IAAI,CAAC,IAAA,qKAAQ,EAAC,WAAW,OAAO;IAChC,MAAM,EAAE,MAAM,EAAE,wBAAwB,4BAA4B,EAAE,GAAG,MAAM,IAAA,mKAAc;IAC7F,IAAI,CAAC,QAAQ,MAAM,IAAI,MAAM;IAC7B,OAAO,yHAAS,CAAC,QAAQ,sBAAsB;AACjD;AACA,SAAS,6BAA6B,GAAG;IACvC,MAAM,SAAS,IAAI,IAAI;IACvB,OAAO,IAAA,uKAAU,EAAC,mBAAmB,GAAG,OAAO,QAAQ,GAAG,OAAO,QAAQ,EAAE;AAC7E;AACA,eAAe,YAAY,QAAQ,EAAE,YAAY;IAC/C,MAAM,cAAc,MAAM,IAAA,mKAAc;IACxC,MAAM,kBAAkB,MAAM,mBAAmB;IACjD,IAAI,mBAAmB;IACvB,IAAI,CAAC,IAAA,qKAAQ,EAAC,WAAW;QACvB,mBAAmB,6HAAa,CAAC,IAAA,8HAAG,KAAI;IAC1C;IACA,MAAM,kBAAkB;QACtB,QAAQ;QACR,eAAe;QACf,GAAG,YAAY;QACf;QACA,UAAU,YAAY,QAAQ;QAC9B,kBAAkB,CAAC;QACnB,WAAW,KAAK,GAAG;QACnB,WAAW,KAAK,GAAG;IACrB;IACA,IAAI,CAAC,IAAA,qKAAQ,EAAC,WAAW;QACvB,IAAI;YACF,gBAAgB,IAAI,GAAG,CAAC,MAAM,IAAA,6IAAI,EAAC,SAAS,GAAG;QACjD,EAAE,OAAM,CACR;IACF;IACA,MAAM,YAAY,SAAS,CAAC,iBAAiB;IAC7C,OAAO;AACT;AACA,eAAe,YAAY,QAAQ,EAAE,YAAY;IAC/C,MAAM,cAAc,MAAM,IAAA,mKAAc;IACxC,MAAM,kBAAkB,MAAM,mBAAmB;IACjD,MAAM,eAAe,MAAM,SAAS;IACpC,IAAI,CAAC,cAAc;QACjB,MAAM,IAAI,MAAM,CAAC,iBAAiB,EAAE,UAAU;IAChD;IACA,IAAI,kBAAkB,IAAA,sKAAS,EAAC,cAAc,cAAc;QAC1D,WAAW,KAAK,GAAG;IACrB;IACA,kBAAkB,eAAe,sKAAc;IAC/C,MAAM,YAAY,WAAW,CAAC,iBAAiB;IAC/C,OAAO;AACT;AACA,SAAS,eAAe,aAAa,EAAE,KAAK;IAC1C,MAAM,WAAW,MAAM,QAAQ;IAC/B,IAAI,CAAC,UAAU,OAAO;IACtB,KAAK,IAAI,CAAC,KAAK,YAAY,IAAI,OAAO,OAAO,CAAC,eAAgB;QAC5D,IAAI,QAAQ,IAAA,sKAAS,EAAC,WAAW;YAC/B,OAAO,YAAY,SAAS,CAAC;QAC/B;IACF;IACA,OAAO;AACT","ignoreList":[0]}},
    {"offset": {"line": 492, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/node_modules/next-video/dist/utils/logger.js"],"sourcesContent":["import chalk from \"chalk\";\nfunction base(type, ...messages) {\n  console[type](...messages);\n}\nfunction log(...messages) {\n  base(\"log\", ...messages);\n}\nfunction info(...messages) {\n  base(\"log\", chalk.blue.bold(\"-\"), ...messages);\n}\nfunction success(...messages) {\n  base(\"log\", chalk.green.bold(\"\\u2713\"), ...messages);\n}\nfunction add(...messages) {\n  base(\"log\", chalk.blue.green(\"+\"), ...messages);\n}\nfunction warning(...messages) {\n  base(\"log\", chalk.yellow.bold(\"\\u26A0\"), ...messages);\n}\nfunction error(...messages) {\n  base(\"error\", chalk.red.bold(\"\\u2717\"), ...messages);\n  base(\"log\", \"\");\n}\nfunction space(...messages) {\n  base(\"log\", \" \", ...messages);\n}\nfunction label(detail) {\n  return chalk.magenta.bold(detail);\n}\nvar logger_default = {\n  base,\n  log,\n  info,\n  success,\n  add,\n  warning,\n  error,\n  space,\n  label\n};\nexport {\n  add,\n  base,\n  logger_default as default,\n  error,\n  info,\n  label,\n  log,\n  space,\n  success,\n  warning\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA,SAAS,KAAK,IAAI,EAAE,GAAG,QAAQ;IAC7B,OAAO,CAAC,KAAK,IAAI;AACnB;AACA,SAAS,IAAI,GAAG,QAAQ;IACtB,KAAK,UAAU;AACjB;AACA,SAAS,KAAK,GAAG,QAAQ;IACvB,KAAK,OAAO,qJAAK,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS;AACvC;AACA,SAAS,QAAQ,GAAG,QAAQ;IAC1B,KAAK,OAAO,qJAAK,CAAC,KAAK,CAAC,IAAI,CAAC,cAAc;AAC7C;AACA,SAAS,IAAI,GAAG,QAAQ;IACtB,KAAK,OAAO,qJAAK,CAAC,IAAI,CAAC,KAAK,CAAC,SAAS;AACxC;AACA,SAAS,QAAQ,GAAG,QAAQ;IAC1B,KAAK,OAAO,qJAAK,CAAC,MAAM,CAAC,IAAI,CAAC,cAAc;AAC9C;AACA,SAAS,MAAM,GAAG,QAAQ;IACxB,KAAK,SAAS,qJAAK,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc;IAC3C,KAAK,OAAO;AACd;AACA,SAAS,MAAM,GAAG,QAAQ;IACxB,KAAK,OAAO,QAAQ;AACtB;AACA,SAAS,MAAM,MAAM;IACnB,OAAO,qJAAK,CAAC,OAAO,CAAC,IAAI,CAAC;AAC5B;AACA,IAAI,iBAAiB;IACnB;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;AACF","ignoreList":[0]}},
    {"offset": {"line": 560, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/node_modules/next-video/dist/utils/queue.js"],"sourcesContent":["class Queue {\n  constructor(delayMs = 1e3) {\n    this.lastRequestTime = null;\n    this.requestQueue = [];\n    this.processing = false;\n    this.delayMs = delayMs;\n  }\n  async enqueue(fn) {\n    return new Promise((resolve, reject) => {\n      this.requestQueue.push({ fn, resolve, reject });\n      if (!this.processing) {\n        this.processNext();\n      }\n    });\n  }\n  processNext() {\n    if (this.requestQueue.length === 0) {\n      this.processing = false;\n      return;\n    }\n    this.processing = true;\n    if (this.lastRequestTime !== null) {\n      const elapsed = Date.now() - this.lastRequestTime;\n      const waitTime = this.delayMs - elapsed;\n      if (waitTime > 0) {\n        setTimeout(() => this.executeNextRequest(), waitTime);\n      } else {\n        this.executeNextRequest();\n      }\n    } else {\n      this.executeNextRequest();\n    }\n  }\n  executeNextRequest() {\n    const item = this.requestQueue.shift();\n    if (!item) {\n      this.processing = false;\n      return;\n    }\n    const { fn, resolve, reject } = item;\n    fn().then((result) => {\n      resolve(result);\n    }).catch((err) => {\n      reject(err);\n    }).finally(() => {\n      this.lastRequestTime = Date.now();\n      this.processNext();\n    });\n  }\n}\nexport {\n  Queue\n};\n"],"names":[],"mappings":";;;;AAAA,MAAM;IACJ,YAAY,UAAU,GAAG,CAAE;QACzB,IAAI,CAAC,eAAe,GAAG;QACvB,IAAI,CAAC,YAAY,GAAG,EAAE;QACtB,IAAI,CAAC,UAAU,GAAG;QAClB,IAAI,CAAC,OAAO,GAAG;IACjB;IACA,MAAM,QAAQ,EAAE,EAAE;QAChB,OAAO,IAAI,QAAQ,CAAC,SAAS;YAC3B,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;gBAAE;gBAAI;gBAAS;YAAO;YAC7C,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE;gBACpB,IAAI,CAAC,WAAW;YAClB;QACF;IACF;IACA,cAAc;QACZ,IAAI,IAAI,CAAC,YAAY,CAAC,MAAM,KAAK,GAAG;YAClC,IAAI,CAAC,UAAU,GAAG;YAClB;QACF;QACA,IAAI,CAAC,UAAU,GAAG;QAClB,IAAI,IAAI,CAAC,eAAe,KAAK,MAAM;YACjC,MAAM,UAAU,KAAK,GAAG,KAAK,IAAI,CAAC,eAAe;YACjD,MAAM,WAAW,IAAI,CAAC,OAAO,GAAG;YAChC,IAAI,WAAW,GAAG;gBAChB,WAAW,IAAM,IAAI,CAAC,kBAAkB,IAAI;YAC9C,OAAO;gBACL,IAAI,CAAC,kBAAkB;YACzB;QACF,OAAO;YACL,IAAI,CAAC,kBAAkB;QACzB;IACF;IACA,qBAAqB;QACnB,MAAM,OAAO,IAAI,CAAC,YAAY,CAAC,KAAK;QACpC,IAAI,CAAC,MAAM;YACT,IAAI,CAAC,UAAU,GAAG;YAClB;QACF;QACA,MAAM,EAAE,EAAE,EAAE,OAAO,EAAE,MAAM,EAAE,GAAG;QAChC,KAAK,IAAI,CAAC,CAAC;YACT,QAAQ;QACV,GAAG,KAAK,CAAC,CAAC;YACR,OAAO;QACT,GAAG,OAAO,CAAC;YACT,IAAI,CAAC,eAAe,GAAG,KAAK,GAAG;YAC/B,IAAI,CAAC,WAAW;QAClB;IACF;AACF","ignoreList":[0]}},
    {"offset": {"line": 623, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/node_modules/next-video/dist/providers/mux/provider.js"],"sourcesContent":["import { createReadStream } from \"node:fs\";\nimport fs from \"node:fs/promises\";\nimport chalk from \"chalk\";\nimport Mux from \"@mux/mux-node\";\nimport { fetch as uFetch } from \"undici\";\nimport { minimatch } from \"minimatch\";\nimport { updateAsset } from \"../../assets.js\";\nimport { getVideoConfig } from \"../../config.js\";\nimport log from \"../../utils/logger.js\";\nimport { sleep } from \"../../utils/utils.js\";\nimport { Queue } from \"../../utils/queue.js\";\nfunction validateNewAssetSettings(newAssetSettings) {\n  const errors = [];\n  if (!newAssetSettings || typeof newAssetSettings !== \"object\") {\n    errors.push(\"newAssetSettings must be an object\");\n    return { valid: false, errors };\n  }\n  if (newAssetSettings.maxResolutionTier !== void 0) {\n    const validResolutions = [\"1080p\", \"1440p\", \"2160p\"];\n    if (!validResolutions.includes(newAssetSettings.maxResolutionTier)) {\n      errors.push(`maxResolutionTier must be one of: ${validResolutions.join(\", \")}`);\n    }\n  }\n  if (newAssetSettings.videoQuality !== void 0) {\n    const validQualities = [\"basic\", \"plus\", \"premium\"];\n    if (!validQualities.includes(newAssetSettings.videoQuality)) {\n      errors.push(`videoQuality must be one of: ${validQualities.join(\", \")}`);\n    }\n  }\n  const validProperties = [\"maxResolutionTier\", \"videoQuality\"];\n  const unknownProperties = Object.keys(newAssetSettings).filter((key) => !validProperties.includes(key));\n  if (unknownProperties.length > 0) {\n    errors.push(`Unknown properties: ${unknownProperties.join(\", \")}. Valid properties: ${validProperties.join(\", \")}`);\n  }\n  return { valid: errors.length === 0, errors };\n}\nfunction getNewAssetSettings(filePath, muxConfig) {\n  try {\n    if (!filePath) {\n      return void 0;\n    }\n    const normalizedFilePath = filePath.replace(/\\\\/g, \"/\");\n    if (muxConfig?.newAssetSettings?.[filePath] || muxConfig?.newAssetSettings?.[normalizedFilePath]) {\n      const newAssetSettings = muxConfig.newAssetSettings[filePath] || muxConfig.newAssetSettings[normalizedFilePath];\n      log.info(log.label(\"Asset settings:\"), \"Using exact path match\");\n      return newAssetSettings;\n    }\n    if (muxConfig?.newAssetSettings) {\n      for (const [pattern, newAssetSettings] of Object.entries(muxConfig.newAssetSettings)) {\n        if (minimatch(normalizedFilePath, pattern)) {\n          log.info(log.label(\"Asset settings:\"), \"Using pattern match\");\n          return newAssetSettings;\n        }\n      }\n    }\n    return void 0;\n  } catch (e) {\n    log.error(\"Error retrieving asset settings for file:\", filePath);\n    return void 0;\n  }\n}\nlet mux;\nlet queue;\nfunction initMux() {\n  mux ?? (mux = new Mux());\n  queue ?? (queue = new Queue());\n}\nasync function pollForAssetReady(filePath, asset) {\n  const providerMetadata = asset.providerMetadata?.mux;\n  if (!providerMetadata?.assetId) {\n    log.error(\"No assetId provided for asset.\");\n    console.error(asset);\n    return;\n  }\n  initMux();\n  const assetId = providerMetadata?.assetId;\n  const muxAsset = await mux.video.assets.retrieve(assetId);\n  const playbackId = muxAsset.playback_ids?.[0].id;\n  let updatedAsset = asset;\n  if (providerMetadata?.playbackId !== playbackId) {\n    updatedAsset = await updateAsset(filePath, {\n      providerMetadata: {\n        mux: {\n          playbackId\n        }\n      }\n    });\n  }\n  if (muxAsset.status === \"errored\") {\n    log.error(log.label(\"Asset errored:\"), filePath);\n    log.space(chalk.gray(\">\"), log.label(\"Mux Asset ID:\"), assetId);\n    return updateAsset(filePath, {\n      status: \"error\",\n      error: muxAsset.errors\n    });\n  }\n  if (muxAsset.status === \"ready\") {\n    let blurDataURL;\n    try {\n      blurDataURL = await createThumbHash(`https://image.mux.com/${playbackId}/thumbnail.webp?width=16&height=16`);\n    } catch (e) {\n      log.error(\"Error creating a thumbnail hash.\");\n    }\n    log.success(log.label(\"Asset is ready:\"), filePath);\n    log.space(chalk.gray(\">\"), log.label(\"Playback ID:\"), playbackId);\n    return updateAsset(filePath, {\n      status: \"ready\",\n      blurDataURL,\n      providerMetadata: {\n        mux: {\n          playbackId\n        }\n      }\n    });\n  } else {\n    await sleep(1e3);\n    return pollForAssetReady(filePath, updatedAsset);\n  }\n}\nasync function pollForUploadAsset(filePath, asset) {\n  const providerMetadata = asset.providerMetadata?.mux;\n  if (!providerMetadata?.uploadId) {\n    log.error(\"No uploadId provided for asset.\");\n    console.error(asset);\n    return;\n  }\n  initMux();\n  const uploadId = providerMetadata?.uploadId;\n  const muxUpload = await mux.video.uploads.retrieve(uploadId);\n  if (muxUpload.asset_id) {\n    log.info(log.label(\"Asset is processing:\"), filePath);\n    log.space(chalk.gray(\">\"), log.label(\"Mux Asset ID:\"), muxUpload.asset_id);\n    const processingAsset = await updateAsset(filePath, {\n      status: \"processing\",\n      providerMetadata: {\n        mux: {\n          assetId: muxUpload.asset_id\n        }\n      }\n    });\n    return pollForAssetReady(filePath, processingAsset);\n  } else {\n    await sleep(1e3);\n    return pollForUploadAsset(filePath, asset);\n  }\n}\nasync function createUploadURL(filePath) {\n  try {\n    const { providerConfig } = await getVideoConfig();\n    const muxConfig = providerConfig.mux;\n    const newAssetSettings = getNewAssetSettings(filePath, muxConfig);\n    const upload = await mux.video.uploads.create({\n      cors_origin: \"*\",\n      new_asset_settings: {\n        playback_policy: [\"public\"],\n        video_quality: newAssetSettings?.videoQuality || muxConfig?.videoQuality,\n        max_resolution_tier: newAssetSettings?.maxResolutionTier\n      }\n    });\n    return upload;\n  } catch (e) {\n    if (e instanceof Error && \"status\" in e && e.status === 401) {\n      log.error(\"Unauthorized request. Check that your MUX_TOKEN_ID and MUX_TOKEN_SECRET credentials are valid.\");\n    } else {\n      log.error(\"Error creating a Mux Direct Upload\");\n      console.error(e);\n    }\n    return void 0;\n  }\n}\nasync function uploadLocalFile(asset) {\n  const filePath = asset.originalFilePath;\n  if (!filePath) {\n    log.error(\"No filePath provided for asset.\");\n    console.error(asset);\n    return;\n  }\n  initMux();\n  if (asset.status === \"ready\") {\n    return;\n  } else if (asset.status === \"processing\") {\n    log.info(log.label(\"Asset is already processing. Polling for completion:\"), filePath);\n    return pollForAssetReady(filePath, asset);\n  } else if (asset.status === \"uploading\") {\n    log.info(log.label(\"Resuming upload:\"), filePath);\n  }\n  if (filePath && /^https?:\\/\\//.test(filePath)) {\n    return uploadRequestedFile(asset);\n  }\n  const upload = await queue.enqueue(() => createUploadURL(filePath));\n  if (!upload) {\n    return;\n  }\n  await updateAsset(filePath, {\n    status: \"uploading\",\n    providerMetadata: {\n      mux: {\n        uploadId: upload.id\n        // more typecasting while we use the beta mux sdk\n      }\n    }\n  });\n  const fileStats = await fs.stat(filePath);\n  const stream = createReadStream(filePath);\n  log.info(log.label(\"Uploading file:\"), `${filePath} (${fileStats.size} bytes)`);\n  try {\n    await uFetch(upload.url, {\n      method: \"PUT\",\n      // @ts-ignore\n      body: stream,\n      duplex: \"half\"\n    });\n    stream.close();\n  } catch (e) {\n    log.error(\"Error uploading to the Mux upload URL\");\n    console.error(e);\n    return;\n  }\n  log.success(log.label(\"File uploaded:\"), `${filePath} (${fileStats.size} bytes)`);\n  const processingAsset = await updateAsset(filePath, {\n    status: \"processing\"\n  });\n  return pollForUploadAsset(filePath, processingAsset);\n}\nasync function uploadRequestedFile(asset) {\n  const filePath = asset.originalFilePath;\n  if (!filePath) {\n    log.error(\"No URL provided for asset.\");\n    console.error(asset);\n    return;\n  }\n  initMux();\n  if (asset.status === \"ready\") {\n    return;\n  } else if (asset.status === \"processing\") {\n    log.info(log.label(\"Asset is already processing. Polling for completion:\"), filePath);\n    return pollForAssetReady(filePath, asset);\n  }\n  const { providerConfig } = await getVideoConfig();\n  const muxConfig = providerConfig.mux;\n  const newAssetSettings = getNewAssetSettings(filePath, muxConfig);\n  const assetObj = await mux.video.assets.create({\n    input: [\n      {\n        url: filePath\n      }\n    ],\n    playback_policy: [\"public\"],\n    video_quality: newAssetSettings?.videoQuality || muxConfig?.videoQuality,\n    max_resolution_tier: newAssetSettings?.maxResolutionTier\n  });\n  log.info(log.label(\"Asset is processing:\"), filePath);\n  log.space(chalk.gray(\">\"), log.label(\"Mux Asset ID:\"), assetObj.id);\n  const processingAsset = await updateAsset(filePath, {\n    status: \"processing\",\n    providerMetadata: {\n      mux: {\n        assetId: assetObj.id\n      }\n    }\n  });\n  return pollForAssetReady(filePath, processingAsset);\n}\nasync function createThumbHash(imgUrl) {\n  const response = await uFetch(imgUrl);\n  const buffer = await response.arrayBuffer();\n  const base64String = btoa(String.fromCharCode(...new Uint8Array(buffer)));\n  return `data:image/webp;base64,${base64String}`;\n}\nexport {\n  createThumbHash,\n  uploadLocalFile,\n  uploadRequestedFile,\n  validateNewAssetSettings\n};\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 938, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/node_modules/next-video/dist/utils/provider.js"],"sourcesContent":["import * as path from \"node:path\";\nimport { getVideoConfig } from \"../config.js\";\nimport { isRemote } from \"./utils.js\";\nasync function createAssetKey(filePathOrURL, provider) {\n  const { folder, providerConfig } = await getVideoConfig();\n  const config = providerConfig[provider];\n  const { generateAssetKey = defaultGenerateAssetKey } = config ?? {};\n  return generateAssetKey(filePathOrURL, folder);\n}\nfunction defaultGenerateAssetKey(filePathOrURL, folder) {\n  if (!isRemote(filePathOrURL)) return filePathOrURL;\n  const url = new URL(filePathOrURL);\n  return path.posix.join(folder, path.basename(decodeURIComponent(url.pathname)));\n}\nexport {\n  createAssetKey\n};\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AACA,eAAe,eAAe,aAAa,EAAE,QAAQ;IACnD,MAAM,EAAE,MAAM,EAAE,cAAc,EAAE,GAAG,MAAM,IAAA,mKAAc;IACvD,MAAM,SAAS,cAAc,CAAC,SAAS;IACvC,MAAM,EAAE,mBAAmB,uBAAuB,EAAE,GAAG,UAAU,CAAC;IAClE,OAAO,iBAAiB,eAAe;AACzC;AACA,SAAS,wBAAwB,aAAa,EAAE,MAAM;IACpD,IAAI,CAAC,IAAA,qKAAQ,EAAC,gBAAgB,OAAO;IACrC,MAAM,MAAM,IAAI,IAAI;IACpB,OAAO,0HAAU,CAAC,IAAI,CAAC,QAAQ,6HAAa,CAAC,mBAAmB,IAAI,QAAQ;AAC9E","ignoreList":[0]}},
    {"offset": {"line": 964, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/node_modules/next-video/dist/providers/vercel-blob/provider.js"],"sourcesContent":["import { ReadStream, createReadStream } from \"node:fs\";\nimport fs from \"node:fs/promises\";\nimport { fetch as uFetch } from \"undici\";\nimport { put } from \"@vercel/blob\";\nimport chalk from \"chalk\";\nimport { updateAsset } from \"../../assets.js\";\nimport { createAssetKey } from \"../../utils/provider.js\";\nimport { isRemote } from \"../../utils/utils.js\";\nimport log from \"../../utils/logger.js\";\nconst config = {\n  runtime: \"edge\"\n};\nasync function uploadLocalFile(asset) {\n  const filePath = asset.originalFilePath;\n  if (!filePath) {\n    log.error(\"No filePath provided for asset.\");\n    console.error(asset);\n    return;\n  }\n  if (isRemote(filePath)) {\n    return uploadRequestedFile(asset);\n  }\n  if (asset.status === \"ready\") {\n    return;\n  } else if (asset.status === \"uploading\") {\n    log.info(log.label(\"Resuming upload:\"), filePath);\n  }\n  await updateAsset(filePath, {\n    status: \"uploading\"\n  });\n  const fileStats = await fs.stat(filePath);\n  const stream = createReadStream(filePath);\n  return putAsset(filePath, fileStats.size, stream);\n}\nasync function uploadRequestedFile(asset) {\n  const filePath = asset.originalFilePath;\n  if (!filePath) {\n    log.error(\"No URL provided for asset.\");\n    console.error(asset);\n    return;\n  }\n  if (asset.status === \"ready\") {\n    return;\n  }\n  await updateAsset(filePath, {\n    status: \"uploading\"\n  });\n  const response = await uFetch(filePath);\n  const size = Number(response.headers.get(\"content-length\"));\n  const stream = response.body;\n  if (!stream) {\n    log.error(\"Error fetching the requested file:\", filePath);\n    return;\n  }\n  return putAsset(filePath, size, stream);\n}\nasync function putAsset(filePath, size, stream) {\n  log.info(log.label(\"Uploading file:\"), `${filePath} (${size} bytes)`);\n  let key;\n  let blob;\n  try {\n    key = await createAssetKey(filePath, \"vercel-blob\");\n    blob = await put(key, stream, { access: \"public\" });\n    if (stream instanceof ReadStream) {\n      stream.close();\n    }\n  } catch (e) {\n    log.error(\"Error uploading to Vercel Blob\");\n    console.error(e);\n    return;\n  }\n  log.success(log.label(\"File uploaded:\"), `${filePath} (${size} bytes)`);\n  log.space(chalk.gray(\">\"), log.label(\"URL:\"), blob.url);\n  const updatedAsset = await updateAsset(filePath, {\n    status: \"ready\",\n    providerMetadata: {\n      \"vercel-blob\": {\n        key,\n        url: blob.url,\n        contentType: blob.contentType\n      }\n    }\n  });\n  const url = updatedAsset.sources?.[0].src;\n  log.space(chalk.gray(\">\"), log.label(\"URL:\"), url);\n  return updatedAsset;\n}\nexport {\n  config,\n  uploadLocalFile,\n  uploadRequestedFile\n};\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;AACA,MAAM,SAAS;IACb,SAAS;AACX;AACA,eAAe,gBAAgB,KAAK;IAClC,MAAM,WAAW,MAAM,gBAAgB;IACvC,IAAI,CAAC,UAAU;QACb,qKAAG,CAAC,KAAK,CAAC;QACV,QAAQ,KAAK,CAAC;QACd;IACF;IACA,IAAI,IAAA,qKAAQ,EAAC,WAAW;QACtB,OAAO,oBAAoB;IAC7B;IACA,IAAI,MAAM,MAAM,KAAK,SAAS;QAC5B;IACF,OAAO,IAAI,MAAM,MAAM,KAAK,aAAa;QACvC,qKAAG,CAAC,IAAI,CAAC,qKAAG,CAAC,KAAK,CAAC,qBAAqB;IAC1C;IACA,MAAM,IAAA,gKAAW,EAAC,UAAU;QAC1B,QAAQ;IACV;IACA,MAAM,YAAY,MAAM,gJAAE,CAAC,IAAI,CAAC;IAChC,MAAM,SAAS,IAAA,iIAAgB,EAAC;IAChC,OAAO,SAAS,UAAU,UAAU,IAAI,EAAE;AAC5C;AACA,eAAe,oBAAoB,KAAK;IACtC,MAAM,WAAW,MAAM,gBAAgB;IACvC,IAAI,CAAC,UAAU;QACb,qKAAG,CAAC,KAAK,CAAC;QACV,QAAQ,KAAK,CAAC;QACd;IACF;IACA,IAAI,MAAM,MAAM,KAAK,SAAS;QAC5B;IACF;IACA,MAAM,IAAA,gKAAW,EAAC,UAAU;QAC1B,QAAQ;IACV;IACA,MAAM,WAAW,MAAM,IAAA,0IAAM,EAAC;IAC9B,MAAM,OAAO,OAAO,SAAS,OAAO,CAAC,GAAG,CAAC;IACzC,MAAM,SAAS,SAAS,IAAI;IAC5B,IAAI,CAAC,QAAQ;QACX,qKAAG,CAAC,KAAK,CAAC,sCAAsC;QAChD;IACF;IACA,OAAO,SAAS,UAAU,MAAM;AAClC;AACA,eAAe,SAAS,QAAQ,EAAE,IAAI,EAAE,MAAM;IAC5C,qKAAG,CAAC,IAAI,CAAC,qKAAG,CAAC,KAAK,CAAC,oBAAoB,GAAG,SAAS,EAAE,EAAE,KAAK,OAAO,CAAC;IACpE,IAAI;IACJ,IAAI;IACJ,IAAI;QACF,MAAM,MAAM,IAAA,8KAAc,EAAC,UAAU;QACrC,OAAO,MAAM,IAAA,0KAAG,EAAC,KAAK,QAAQ;YAAE,QAAQ;QAAS;QACjD,IAAI,kBAAkB,2HAAU,EAAE;YAChC,OAAO,KAAK;QACd;IACF,EAAE,OAAO,GAAG;QACV,qKAAG,CAAC,KAAK,CAAC;QACV,QAAQ,KAAK,CAAC;QACd;IACF;IACA,qKAAG,CAAC,OAAO,CAAC,qKAAG,CAAC,KAAK,CAAC,mBAAmB,GAAG,SAAS,EAAE,EAAE,KAAK,OAAO,CAAC;IACtE,qKAAG,CAAC,KAAK,CAAC,qJAAK,CAAC,IAAI,CAAC,MAAM,qKAAG,CAAC,KAAK,CAAC,SAAS,KAAK,GAAG;IACtD,MAAM,eAAe,MAAM,IAAA,gKAAW,EAAC,UAAU;QAC/C,QAAQ;QACR,kBAAkB;YAChB,eAAe;gBACb;gBACA,KAAK,KAAK,GAAG;gBACb,aAAa,KAAK,WAAW;YAC/B;QACF;IACF;IACA,MAAM,MAAM,aAAa,OAAO,EAAE,CAAC,EAAE,CAAC;IACtC,qKAAG,CAAC,KAAK,CAAC,qJAAK,CAAC,IAAI,CAAC,MAAM,qKAAG,CAAC,KAAK,CAAC,SAAS;IAC9C,OAAO;AACT","ignoreList":[0]}},
    {"offset": {"line": 1075, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/node_modules/next-video/dist/utils/s3.js"],"sourcesContent":["import {\n  PutBucketCorsCommand,\n  CreateBucketCommand,\n  PutObjectCommand,\n  ListBucketsCommand,\n  DeletePublicAccessBlockCommand,\n  PutBucketAclCommand\n} from \"@aws-sdk/client-s3\";\nasync function findBucket(s3, callbackFn) {\n  const { Buckets } = await s3.send(new ListBucketsCommand({}));\n  return Buckets?.find(callbackFn);\n}\nfunction createBucket(s3, bucketName, input) {\n  return s3.send(new CreateBucketCommand({\n    Bucket: bucketName,\n    ...input\n  }));\n}\nasync function putBucketAcl(s3, bucketName, input) {\n  await s3.send(new DeletePublicAccessBlockCommand({\n    Bucket: bucketName\n  }));\n  return s3.send(new PutBucketAclCommand({\n    Bucket: bucketName,\n    ACL: input?.ACL ?? \"public-read\",\n    ...input\n  }));\n}\nfunction putObject(s3, input) {\n  return s3.send(new PutObjectCommand(input));\n}\nfunction putBucketCors(s3, bucketName) {\n  return s3.send(new PutBucketCorsCommand({\n    Bucket: bucketName,\n    CORSConfiguration: {\n      CORSRules: [\n        {\n          // Allow all headers to be sent to this bucket.\n          AllowedHeaders: [\"*\"],\n          // Allow only GET and PUT methods to be sent to this bucket.\n          AllowedMethods: [\"GET\", \"PUT\"],\n          // Allow only requests from the specified origin.\n          AllowedOrigins: [\"*\"],\n          // Allow the entity tag (ETag) header to be returned in the response. The ETag header\n          // The entity tag represents a specific version of the object. The ETag reflects\n          // changes only to the contents of an object, not its metadata.\n          ExposeHeaders: [\"ETag\"],\n          // How long the requesting browser should cache the preflight response. After\n          // this time, the preflight request will have to be made again.\n          MaxAgeSeconds: 3600\n        }\n      ]\n    }\n  }));\n}\nexport {\n  createBucket,\n  findBucket,\n  putBucketAcl,\n  putBucketCors,\n  putObject\n};\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;AAQA,eAAe,WAAW,EAAE,EAAE,UAAU;IACtC,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,GAAG,IAAI,CAAC,IAAI,uKAAkB,CAAC,CAAC;IAC1D,OAAO,SAAS,KAAK;AACvB;AACA,SAAS,aAAa,EAAE,EAAE,UAAU,EAAE,KAAK;IACzC,OAAO,GAAG,IAAI,CAAC,IAAI,wKAAmB,CAAC;QACrC,QAAQ;QACR,GAAG,KAAK;IACV;AACF;AACA,eAAe,aAAa,EAAE,EAAE,UAAU,EAAE,KAAK;IAC/C,MAAM,GAAG,IAAI,CAAC,IAAI,mLAA8B,CAAC;QAC/C,QAAQ;IACV;IACA,OAAO,GAAG,IAAI,CAAC,IAAI,wKAAmB,CAAC;QACrC,QAAQ;QACR,KAAK,OAAO,OAAO;QACnB,GAAG,KAAK;IACV;AACF;AACA,SAAS,UAAU,EAAE,EAAE,KAAK;IAC1B,OAAO,GAAG,IAAI,CAAC,IAAI,qKAAgB,CAAC;AACtC;AACA,SAAS,cAAc,EAAE,EAAE,UAAU;IACnC,OAAO,GAAG,IAAI,CAAC,IAAI,yKAAoB,CAAC;QACtC,QAAQ;QACR,mBAAmB;YACjB,WAAW;gBACT;oBACE,+CAA+C;oBAC/C,gBAAgB;wBAAC;qBAAI;oBACrB,4DAA4D;oBAC5D,gBAAgB;wBAAC;wBAAO;qBAAM;oBAC9B,iDAAiD;oBACjD,gBAAgB;wBAAC;qBAAI;oBACrB,qFAAqF;oBACrF,gFAAgF;oBAChF,+DAA+D;oBAC/D,eAAe;wBAAC;qBAAO;oBACvB,6EAA6E;oBAC7E,+DAA+D;oBAC/D,eAAe;gBACjB;aACD;QACH;IACF;AACF","ignoreList":[0]}},
    {"offset": {"line": 1150, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/node_modules/next-video/dist/providers/backblaze/provider.js"],"sourcesContent":["import { ReadStream, createReadStream } from \"node:fs\";\nimport { Readable } from \"node:stream\";\nimport fs from \"node:fs/promises\";\nimport { env } from \"node:process\";\nimport { fetch as uFetch } from \"undici\";\nimport chalk from \"chalk\";\nimport cuid2 from \"@paralleldrive/cuid2\";\nimport { S3Client } from \"@aws-sdk/client-s3\";\nimport { updateAsset } from \"../../assets.js\";\nimport { getVideoConfig } from \"../../config.js\";\nimport { findBucket, createBucket, putBucketCors, putObject } from \"../../utils/s3.js\";\nimport { createAssetKey } from \"../../utils/provider.js\";\nimport { isRemote } from \"../../utils/utils.js\";\nimport log from \"../../utils/logger.js\";\nconst createId = cuid2.init({ length: 11 });\nlet s3;\nlet bucketName;\nlet endpoint;\nasync function initS3() {\n  const { providerConfig } = await getVideoConfig();\n  const backblazeConfig = providerConfig.backblaze;\n  bucketName = backblazeConfig?.bucket ?? \"\";\n  endpoint = backblazeConfig?.endpoint ?? \"\";\n  const regionMatch = endpoint.match(/\\.([a-z0-9-]+)\\.backblazeb2\\.com$/);\n  const region = regionMatch ? regionMatch[1] : \"\";\n  s3 ?? (s3 = new S3Client({\n    endpoint,\n    region,\n    credentials: {\n      accessKeyId: backblazeConfig?.accessKeyId ?? env.BACKBLAZE_ACCESS_KEY_ID ?? \"\",\n      secretAccessKey: backblazeConfig?.secretAccessKey ?? env.BACKBLAZE_SECRET_ACCESS_KEY ?? \"\"\n    }\n  }));\n  if (!bucketName) {\n    try {\n      const bucket = await findBucket(s3, (bucket2) => bucket2.Name?.startsWith(\"next-videos-\"));\n      if (bucket) {\n        bucketName = bucket.Name;\n        log.info(log.label(\"Using existing Backblaze bucket:\"), bucketName);\n      }\n    } catch (err) {\n      log.error(\"Error listing Backblaze buckets\");\n      console.error(err);\n    }\n  }\n  if (!bucketName) {\n    bucketName = `next-videos-${createId()}`;\n    log.info(log.label(\"Creating Backblaze bucket:\"), bucketName);\n    try {\n      await createBucket(s3, bucketName, {\n        ACL: \"public-read\"\n      });\n      await putBucketCors(s3, bucketName);\n    } catch (err) {\n      log.error(\"Error creating Backblaze bucket\");\n      console.error(err);\n    }\n  }\n}\nasync function uploadLocalFile(asset) {\n  const filePath = asset.originalFilePath;\n  if (!filePath) {\n    log.error(\"No filePath provided for asset.\");\n    console.error(asset);\n    return;\n  }\n  if (isRemote(filePath)) {\n    return uploadRequestedFile(asset);\n  }\n  if (asset.status === \"ready\") {\n    return;\n  } else if (asset.status === \"uploading\") {\n    log.info(log.label(\"Resuming upload:\"), filePath);\n  }\n  await updateAsset(filePath, {\n    status: \"uploading\"\n  });\n  await initS3();\n  const fileStats = await fs.stat(filePath);\n  const stream = createReadStream(filePath);\n  return putAsset(filePath, fileStats.size, stream);\n}\nasync function uploadRequestedFile(asset) {\n  const filePath = asset.originalFilePath;\n  if (!filePath) {\n    log.error(\"No URL provided for asset.\");\n    console.error(asset);\n    return;\n  }\n  if (asset.status === \"ready\") {\n    return;\n  }\n  await updateAsset(filePath, {\n    status: \"uploading\"\n  });\n  await initS3();\n  const response = await uFetch(filePath);\n  const size = Number(response.headers.get(\"content-length\"));\n  const stream = response.body;\n  if (!stream) {\n    log.error(\"Error fetching the requested file:\", filePath);\n    return;\n  }\n  return putAsset(filePath, size, Readable.fromWeb(stream));\n}\nasync function putAsset(filePath, size, stream) {\n  log.info(log.label(\"Uploading file:\"), `${filePath} (${size} bytes)`);\n  let key;\n  try {\n    key = await createAssetKey(filePath, \"backblaze\");\n    await putObject(s3, {\n      Bucket: bucketName,\n      Key: key,\n      Body: stream,\n      ContentLength: size\n    });\n    if (stream instanceof ReadStream) {\n      stream.close();\n    }\n  } catch (e) {\n    log.error(\"Error uploading to Backblaze B2\");\n    console.error(e);\n    return;\n  }\n  log.success(log.label(\"File uploaded:\"), `${filePath} (${size} bytes)`);\n  const updatedAsset = await updateAsset(filePath, {\n    status: \"ready\",\n    providerMetadata: {\n      backblaze: {\n        endpoint,\n        bucket: bucketName,\n        key\n      }\n    }\n  });\n  const url = updatedAsset.sources?.[0].src;\n  log.space(chalk.gray(\">\"), log.label(\"URL:\"), url);\n  return updatedAsset;\n}\nexport {\n  uploadLocalFile,\n  uploadRequestedFile\n};\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 1316, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/node_modules/next-video/dist/providers/amazon-s3/provider.js"],"sourcesContent":["import { ReadStream, createReadStream } from \"node:fs\";\nimport { Readable } from \"node:stream\";\nimport fs from \"node:fs/promises\";\nimport { env } from \"node:process\";\nimport { fetch as uFetch } from \"undici\";\nimport chalk from \"chalk\";\nimport cuid2 from \"@paralleldrive/cuid2\";\nimport { S3Client } from \"@aws-sdk/client-s3\";\nimport { updateAsset } from \"../../assets.js\";\nimport { getVideoConfig } from \"../../config.js\";\nimport { findBucket, createBucket, putBucketCors, putObject, putBucketAcl } from \"../../utils/s3.js\";\nimport { createAssetKey } from \"../../utils/provider.js\";\nimport { isRemote } from \"../../utils/utils.js\";\nimport log from \"../../utils/logger.js\";\nconst createId = cuid2.init({ length: 11 });\nlet s3;\nlet bucketName;\nlet endpoint;\nasync function initS3() {\n  const { providerConfig } = await getVideoConfig();\n  const amazonS3Config = providerConfig[\"amazon-s3\"];\n  bucketName = amazonS3Config?.bucket ?? \"\";\n  endpoint = amazonS3Config?.endpoint ?? \"\";\n  const regionMatch = endpoint.match(/\\.([a-z0-9-]+)\\.amazonaws\\.com$/);\n  const region = regionMatch ? regionMatch[1] : \"\";\n  s3 ?? (s3 = new S3Client({\n    endpoint,\n    region,\n    credentials: {\n      accessKeyId: amazonS3Config?.accessKeyId ?? env.AWS_ACCESS_KEY_ID ?? \"\",\n      secretAccessKey: amazonS3Config?.secretAccessKey ?? env.AWS_SECRET_ACCESS_KEY ?? \"\"\n    }\n  }));\n  if (!bucketName) {\n    try {\n      const bucket = await findBucket(s3, (bucket2) => bucket2.Name?.startsWith(\"next-videos-\"));\n      if (bucket) {\n        bucketName = bucket.Name;\n        log.info(log.label(\"Using existing Amazon S3 bucket:\"), bucketName);\n      }\n    } catch (err) {\n      log.error(\"Error listing Amazon S3 buckets\");\n      console.error(err);\n    }\n  }\n  if (!bucketName) {\n    bucketName = `next-videos-${createId()}`;\n    log.info(log.label(\"Creating Amazon S3 bucket:\"), bucketName);\n    try {\n      await createBucket(s3, bucketName, {\n        // https://aws.amazon.com/blogs/aws/heads-up-amazon-s3-security-changes-are-coming-in-april-of-2023/\n        // Can't set ACL here since the security changes, but we can set it after the bucket is created.\n        // S3ServiceException [InvalidBucketAclWithBlockPublicAccessError]: Bucket cannot have public ACLs set with BlockPublicAccess enabled\n        // ACL: 'public-read',\n        // Since the security changes the default ObjectOwnership is BucketOwnerEnforced which doesn't allow ACLs. Change it here.\n        // InvalidBucketAclWithObjectOwnership: Bucket cannot have ACLs set with ObjectOwnership's BucketOwnerEnforced setting\n        ObjectOwnership: \"ObjectWriter\"\n      });\n      await putBucketAcl(s3, bucketName);\n      await putBucketCors(s3, bucketName);\n    } catch (err) {\n      log.error(\"Error creating Amazon S3 bucket\");\n      console.error(err);\n    }\n  }\n}\nasync function uploadLocalFile(asset) {\n  const filePath = asset.originalFilePath;\n  if (!filePath) {\n    log.error(\"No filePath provided for asset.\");\n    console.error(asset);\n    return;\n  }\n  if (isRemote(filePath)) {\n    return uploadRequestedFile(asset);\n  }\n  if (asset.status === \"ready\") {\n    return;\n  } else if (asset.status === \"uploading\") {\n    log.info(log.label(\"Resuming upload:\"), filePath);\n  }\n  await updateAsset(filePath, {\n    status: \"uploading\"\n  });\n  await initS3();\n  const fileStats = await fs.stat(filePath);\n  const stream = createReadStream(filePath);\n  return putAsset(filePath, fileStats.size, stream);\n}\nasync function uploadRequestedFile(asset) {\n  const filePath = asset.originalFilePath;\n  if (!filePath) {\n    log.error(\"No URL provided for asset.\");\n    console.error(asset);\n    return;\n  }\n  if (asset.status === \"ready\") {\n    return;\n  }\n  await updateAsset(filePath, {\n    status: \"uploading\"\n  });\n  await initS3();\n  const response = await uFetch(filePath);\n  const size = Number(response.headers.get(\"content-length\"));\n  const stream = response.body;\n  if (!stream) {\n    log.error(\"Error fetching the requested file:\", filePath);\n    return;\n  }\n  return putAsset(filePath, size, Readable.fromWeb(stream));\n}\nasync function putAsset(filePath, size, stream) {\n  log.info(log.label(\"Uploading file:\"), `${filePath} (${size} bytes)`);\n  let key;\n  try {\n    key = await createAssetKey(filePath, \"amazon-s3\");\n    await putObject(s3, {\n      ACL: \"public-read\",\n      Bucket: bucketName,\n      Key: key,\n      Body: stream,\n      ContentLength: size\n    });\n    if (stream instanceof ReadStream) {\n      stream.close();\n    }\n  } catch (e) {\n    log.error(\"Error uploading to Amazon S3\");\n    console.error(e);\n    return;\n  }\n  log.success(log.label(\"File uploaded:\"), `${filePath} (${size} bytes)`);\n  const updatedAsset = await updateAsset(filePath, {\n    status: \"ready\",\n    providerMetadata: {\n      \"amazon-s3\": {\n        endpoint,\n        bucket: bucketName,\n        key\n      }\n    }\n  });\n  const url = updatedAsset.sources?.[0].src;\n  log.space(chalk.gray(\">\"), log.label(\"URL:\"), url);\n  return updatedAsset;\n}\nexport {\n  uploadLocalFile,\n  uploadRequestedFile\n};\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 1490, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/node_modules/next-video/dist/utils/r2.js"],"sourcesContent":["import { request } from \"undici\";\nasync function publicAccessR2Bucket(accountId, bucketName, apiToken) {\n  const url = `https://api.cloudflare.com/client/v4/accounts/${accountId}/r2/buckets/${bucketName}/policy?access=PublicUrlAndCnames`;\n  try {\n    const { statusCode, body } = await request(url, {\n      method: \"PUT\",\n      headers: {\n        Authorization: `Bearer ${apiToken}`,\n        \"Content-Type\": \"application/json\"\n      }\n    });\n    const responseBody = await body.json();\n    if (statusCode !== 200 || !responseBody.success) {\n      throw new Error(\n        `Failed to set public access. Status code: ${statusCode}, Error details: ${JSON.stringify(responseBody.errors)}`\n      );\n    }\n    if (responseBody.result.onlyViaCnames.length > 0) {\n      return responseBody.result.onlyViaCnames[0];\n    } else {\n      return `${responseBody.result.publicId}.r2.dev`;\n    }\n  } catch (error) {\n    throw new Error(`Error setting public access: ${error.message}`);\n  }\n}\nexport {\n  publicAccessR2Bucket\n};\n"],"names":[],"mappings":";;;;AAAA;;AACA,eAAe,qBAAqB,SAAS,EAAE,UAAU,EAAE,QAAQ;IACjE,MAAM,MAAM,CAAC,8CAA8C,EAAE,UAAU,YAAY,EAAE,WAAW,iCAAiC,CAAC;IAClI,IAAI;QACF,MAAM,EAAE,UAAU,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,4IAAO,EAAC,KAAK;YAC9C,QAAQ;YACR,SAAS;gBACP,eAAe,CAAC,OAAO,EAAE,UAAU;gBACnC,gBAAgB;YAClB;QACF;QACA,MAAM,eAAe,MAAM,KAAK,IAAI;QACpC,IAAI,eAAe,OAAO,CAAC,aAAa,OAAO,EAAE;YAC/C,MAAM,IAAI,MACR,CAAC,0CAA0C,EAAE,WAAW,iBAAiB,EAAE,KAAK,SAAS,CAAC,aAAa,MAAM,GAAG;QAEpH;QACA,IAAI,aAAa,MAAM,CAAC,aAAa,CAAC,MAAM,GAAG,GAAG;YAChD,OAAO,aAAa,MAAM,CAAC,aAAa,CAAC,EAAE;QAC7C,OAAO;YACL,OAAO,GAAG,aAAa,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC;QACjD;IACF,EAAE,OAAO,OAAO;QACd,MAAM,IAAI,MAAM,CAAC,6BAA6B,EAAE,MAAM,OAAO,EAAE;IACjE;AACF","ignoreList":[0]}},
    {"offset": {"line": 1524, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/node_modules/next-video/dist/providers/cloudflare-r2/provider.js"],"sourcesContent":["import { ReadStream, createReadStream } from \"node:fs\";\nimport { Readable } from \"node:stream\";\nimport fs from \"node:fs/promises\";\nimport { env } from \"node:process\";\nimport { fetch as uFetch } from \"undici\";\nimport chalk from \"chalk\";\nimport cuid2 from \"@paralleldrive/cuid2\";\nimport { S3Client } from \"@aws-sdk/client-s3\";\nimport { updateAsset } from \"../../assets.js\";\nimport { getVideoConfig } from \"../../config.js\";\nimport { findBucket, createBucket, putBucketCors, putObject } from \"../../utils/s3.js\";\nimport { createAssetKey } from \"../../utils/provider.js\";\nimport { isRemote } from \"../../utils/utils.js\";\nimport log from \"../../utils/logger.js\";\nimport { publicAccessR2Bucket } from \"../../utils/r2.js\";\nconst createId = cuid2.init({ length: 11 });\nlet s3;\nlet bucketName;\nlet bucketUrlPublic;\nlet accountId;\nlet endpoint;\nasync function initR2() {\n  const { providerConfig } = await getVideoConfig();\n  const CloudflareR2Config = providerConfig[\"cloudflare-r2\"];\n  bucketName = CloudflareR2Config?.bucket ?? \"\";\n  bucketUrlPublic = CloudflareR2Config?.bucketUrlPublic ?? \"\";\n  endpoint = CloudflareR2Config?.endpoint ?? \"\";\n  accountId = endpoint.split(\".\")[0].replace(/^https?:\\/\\//, \"\");\n  s3 ?? (s3 = new S3Client({\n    endpoint,\n    // region does not have any impact on Cloudflare R2\n    region: \"auto\",\n    credentials: {\n      accessKeyId: CloudflareR2Config?.accessKeyId ?? env.R2_ACCESS_KEY_ID ?? \"\",\n      secretAccessKey: CloudflareR2Config?.secretAccessKey ?? env.R2_SECRET_ACCESS_KEY ?? \"\"\n    }\n  }));\n  if (!bucketName) {\n    try {\n      const bucket = await findBucket(s3, (bucket2) => bucket2.Name?.startsWith(\"next-videos-\"));\n      if (bucket) {\n        bucketName = bucket.Name;\n        log.info(log.label(\"Using existing Cloudflare R2 bucket:\"), bucketName);\n      }\n    } catch (err) {\n      log.error(\"Error listing Cloudflare R2 buckets\");\n      console.error(err);\n    }\n  }\n  if (!bucketName) {\n    bucketName = `next-videos-${createId()}`;\n    log.info(log.label(\"Creating Cloudflare R2 bucket:\"), bucketName);\n    try {\n      await createBucket(s3, bucketName, {});\n      await putBucketCors(s3, bucketName);\n    } catch (err) {\n      log.error(\"Error creating Cloudflare R2 bucket\");\n      console.error(err);\n    }\n  }\n  if (!bucketUrlPublic && bucketName) {\n    const cloudflareApiToken = CloudflareR2Config?.apiToken ?? env.R2_CF_API_TOKEN ?? \"\";\n    let bucketPublicId;\n    if (cloudflareApiToken) {\n      try {\n        bucketPublicId = await publicAccessR2Bucket(accountId, bucketName, cloudflareApiToken) ?? \"\";\n        bucketUrlPublic = `https://${bucketPublicId}`;\n      } catch (e) {\n        log.error(`Error setting Public access for Cloudflare R2 bucket: ${bucketName}`);\n        console.error(e);\n        return;\n      }\n    }\n  }\n}\nasync function uploadLocalFile(asset) {\n  const filePath = asset.originalFilePath;\n  if (!filePath) {\n    log.error(\"No filePath provided for asset.\");\n    console.error(asset);\n    return;\n  }\n  if (isRemote(filePath)) {\n    return uploadRequestedFile(asset);\n  }\n  if (asset.status === \"ready\") {\n    return;\n  } else if (asset.status === \"uploading\") {\n    log.info(log.label(\"Resuming upload:\"), filePath);\n  }\n  await updateAsset(filePath, {\n    status: \"uploading\"\n  });\n  await initR2();\n  if (!bucketUrlPublic) {\n    log.error(\n      `Public access configuration missing:\n      Neither the Cloudflare API Key nor the bucketUrlPublic URL is specified for the bucket \"${bucketName}\".\n   \n      To enable public access, you must ensure one of the following:\n      1. **Configure the Bucket for Public Access:**\n         - Make sure the bucket \"${bucketName}\" is configured for public access\n           and specify the public URL in the provider configuration under the key 'bucketUrlPublic'.\n         - For detailed instructions, refer to the Cloudflare documentation: \n           https://developers.cloudflare.com/r2/buckets/public-buckets/\n   \n      2. **Provide a Cloudflare API Key:**\n         - You can specify a Cloudflare API Key with R2 Admin read & write permissions using the environment variable: R2_CF_API_TOKEN.\n         - This API Key will allow us to enable public access for the bucket and retrieve the public URL using the Cloudflare API.\n         - To create an API Token, visit:\n           https://dash.cloudflare.com/?to=/:account/r2/api-tokens`\n    );\n    return;\n  }\n  const fileStats = await fs.stat(filePath);\n  const stream = createReadStream(filePath);\n  return putAsset(filePath, fileStats.size, stream);\n}\nasync function uploadRequestedFile(asset) {\n  const filePath = asset.originalFilePath;\n  if (!filePath) {\n    log.error(\"No URL provided for asset.\");\n    console.error(asset);\n    return;\n  }\n  if (asset.status === \"ready\") {\n    return;\n  }\n  await updateAsset(filePath, {\n    status: \"uploading\"\n  });\n  await initR2();\n  const response = await uFetch(filePath);\n  const size = Number(response.headers.get(\"content-length\"));\n  const stream = response.body;\n  if (!stream) {\n    log.error(\"Error fetching the requested file:\", filePath);\n    return;\n  }\n  return putAsset(filePath, size, Readable.fromWeb(stream));\n}\nasync function putAsset(filePath, size, stream) {\n  log.info(log.label(\"Uploading file:\"), `${filePath} (${size} bytes)`);\n  let key;\n  try {\n    key = await createAssetKey(filePath, \"cloudflare-r2\");\n    await putObject(s3, {\n      ACL: \"public-read\",\n      Bucket: bucketName,\n      Key: key,\n      Body: stream,\n      ContentLength: size\n    });\n    if (stream instanceof ReadStream) {\n      stream.close();\n    }\n  } catch (e) {\n    log.error(\"Error uploading to Cloudflare R2\");\n    console.error(e);\n    return;\n  }\n  log.success(log.label(\"File uploaded:\"), `${filePath} (${size} bytes)`);\n  const updatedAsset = await updateAsset(filePath, {\n    status: \"ready\",\n    providerMetadata: {\n      \"cloudflare-r2\": {\n        endpoint,\n        bucketUrlPublic,\n        bucket: bucketName,\n        key\n      }\n    }\n  });\n  const url = updatedAsset.sources?.[0].src;\n  log.space(chalk.gray(\">\"), log.label(\"URL:\"), url);\n  return updatedAsset;\n}\nexport {\n  uploadLocalFile,\n  uploadRequestedFile\n};\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 1727, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/node_modules/next-video/dist/providers/providers.js"],"sourcesContent":["import * as mux from \"./mux/provider.js\";\nimport * as vercelBlob from \"./vercel-blob/provider.js\";\nimport * as backblaze from \"./backblaze/provider.js\";\nimport * as amazonS3 from \"./amazon-s3/provider.js\";\nimport * as cloudflareR2 from \"./cloudflare-r2/provider.js\";\nexport {\n  amazonS3,\n  backblaze,\n  cloudflareR2,\n  mux,\n  vercelBlob\n};\n"],"names":[],"mappings":";AAAA;AACA;AACA;AACA;AACA","ignoreList":[0]}},
    {"offset": {"line": 1765, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/node_modules/next-video/dist/handlers/local-upload.js"],"sourcesContent":["import * as providers from \"../providers/providers.js\";\nimport { camelCase } from \"../utils/utils.js\";\nasync function uploadLocalFile(asset, config) {\n  for (let [key, provider] of Object.entries(providers)) {\n    if (key === camelCase(config.provider)) {\n      return provider.uploadLocalFile(asset);\n    }\n  }\n}\nexport {\n  uploadLocalFile\n};\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AACA,eAAe,gBAAgB,KAAK,EAAE,MAAM;IAC1C,KAAK,IAAI,CAAC,KAAK,SAAS,IAAI,OAAO,OAAO,CAAC,mKAAY;QACrD,IAAI,QAAQ,IAAA,sKAAS,EAAC,OAAO,QAAQ,GAAG;YACtC,OAAO,SAAS,eAAe,CAAC;QAClC;IACF;AACF","ignoreList":[0]}},
    {"offset": {"line": 1786, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/node_modules/next-video/dist/handlers/api-request.js"],"sourcesContent":["import * as providers from \"../providers/providers.js\";\nimport { camelCase } from \"../utils/utils.js\";\nasync function uploadRequestedFile(asset, config) {\n  for (let [key, provider] of Object.entries(providers)) {\n    if (key === camelCase(config.provider)) {\n      return provider.uploadRequestedFile(asset);\n    }\n  }\n}\nexport {\n  uploadRequestedFile\n};\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AACA,eAAe,oBAAoB,KAAK,EAAE,MAAM;IAC9C,KAAK,IAAI,CAAC,KAAK,SAAS,IAAI,OAAO,OAAO,CAAC,mKAAY;QACrD,IAAI,QAAQ,IAAA,sKAAS,EAAC,OAAO,QAAQ,GAAG;YACtC,OAAO,SAAS,mBAAmB,CAAC;QACtC;IACF;AACF","ignoreList":[0]}},
    {"offset": {"line": 1807, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/node_modules/next-video/dist/with-next-video.js"],"sourcesContent":["import symlinkDir from \"symlink-dir\";\nimport { join, dirname } from \"node:path\";\nimport fs from \"node:fs\";\nimport { env } from \"node:process\";\nimport { fileURLToPath } from \"node:url\";\nimport logger from \"./utils/logger.js\";\nimport { getPackageVersion } from \"./utils/utils.js\";\nimport { setVideoConfig } from \"./config.js\";\nlet hasWarned = false;\nfunction withNextVideo(nextConfig, videoConfig) {\n  const videoConfigComplete = setVideoConfig(videoConfig);\n  const { path, folder, provider } = videoConfigComplete;\n  env[\"NEXT_PUBLIC_VIDEO_OPTS\"] = JSON.stringify({ path, folder, provider });\n  if (process.argv[2] === \"dev\") {\n    env[\"NEXT_PUBLIC_DEV_VIDEO_OPTS\"] = JSON.stringify({ path, folder, provider });\n  }\n  if (typeof nextConfig === \"function\") {\n    return async (...args) => {\n      const nextConfigResult = await nextConfig(...args);\n      return withNextVideo(nextConfigResult, videoConfig);\n    };\n  }\n  if (process.argv[2] === \"dev\") {\n    const VIDEOS_PATH = join(process.cwd(), folder);\n    const TMP_PUBLIC_VIDEOS_PATH = join(process.cwd(), \"public\", `_next-video`);\n    symlinkDir(VIDEOS_PATH, TMP_PUBLIC_VIDEOS_PATH);\n    process.on(\"exit\", async () => {\n      fs.unlinkSync(TMP_PUBLIC_VIDEOS_PATH);\n    });\n  }\n  const nextVersion = getPackageVersion(\"next\");\n  const majorVersion = nextVersion ? parseInt(nextVersion.split(\".\")[0], 10) : void 0;\n  if (majorVersion && majorVersion >= 15) {\n    nextConfig.outputFileTracingIncludes = {\n      ...nextConfig.outputFileTracingIncludes,\n      [path]: [`./${folder}/**/*.json`]\n    };\n  } else {\n    const experimental = { ...nextConfig.experimental };\n    experimental.outputFileTracingIncludes = {\n      ...experimental.outputFileTracingIncludes,\n      [path]: [`./${folder}/**/*.json`]\n    };\n    nextConfig.experimental = experimental;\n  }\n  nextConfig.turbopack = {\n    ...nextConfig.turbopack,\n    rules: {\n      ...nextConfig.turbopack?.rules,\n      \"*.mp4\": {\n        loaders: [\n          \"next-video/webpack/video-raw-loader.js\"\n        ],\n        as: \"*.json\"\n      },\n      \"*.json\": {\n        loaders: [\n          \"next-video/webpack/video-json-loader.js\"\n        ],\n        as: \"*.json\"\n      }\n    }\n  };\n  const nextVideoVersion = getPackageVersion(\"next-video\");\n  if (!hasWarned && process.env.TURBOPACK && !process.env.NEXT_VIDEO_SUPPRESS_TURBOPACK_WARNING && nextVersion && isVersionLessThan(nextVersion, \"15.5.0\")) {\n    hasWarned = true;\n    logger.space(logger.label(`\\u25B6\\uFE0E next-video ${nextVideoVersion}\n`));\n    logger.warning(\n      `You are using next-video with \\`next ${true ? \"dev\" : \"build\"} --turbo\\`. next-video doesn't support Turbopack on Next.js 15.5.0 and below.\n  We recommend removing the \\`--turbo\\` flag for use with next-video.\n`\n    );\n  }\n  return Object.assign({}, nextConfig, {\n    webpack(config, options) {\n      if (!options.defaultLoaders) {\n        throw new Error(\n          \"This plugin is not compatible with Next.js versions below 5.0.0 https://err.sh/next-plugins/upgrade\"\n        );\n      }\n      config.infrastructureLogging = {\n        ...config.infrastructureLogging,\n        // Silence warning about dynamic import of next.config file.\n        // > [webpack.cache.PackFileCacheStrategy/webpack.FileSystemInfo] Parsing of /next-video/dist/config.js for build dependencies failed at 'import(fileUrl.\n        // > Build dependencies behind this expression are ignored and might cause incorrect cache invalidation.\n        level: \"error\"\n      };\n      config.experiments.buildHttp = {\n        allowedUris: [\n          /https?:\\/\\/.*\\.(mp4|webm|mkv|ogg|ogv|wmv|avi|mov|flv|m4v|3gp)\\??(?:&?[^=&]*=[^=&]*)*$/,\n          ...config.experiments.buildHttp?.allowedUris ?? []\n        ],\n        ...config.experiments.buildHttp || {},\n        // Disable cache to prevent Webpack from downloading the remote sources.\n        cacheLocation: false\n      };\n      const scriptDir = typeof __dirname === \"string\" ? __dirname : dirname(fileURLToPath(import.meta.url));\n      config.module.rules.push(\n        {\n          test: /\\.(mp4|webm|mkv|ogg|ogv|wmv|avi|mov|flv|m4v|3gp)\\??(?:&?[^=&]*=[^=&]*)*$/,\n          use: [\n            {\n              loader: join(scriptDir, \"webpack/video-json-loader.js\")\n            },\n            {\n              loader: join(scriptDir, \"webpack/video-raw-loader.js\")\n            }\n          ],\n          type: \"json\"\n        },\n        {\n          test: /\\.(mp4|webm|mkv|ogg|ogv|wmv|avi|mov|flv|m4v|3gp)\\.json\\??(?:&?[^=&]*=[^=&]*)*$/,\n          use: [\n            {\n              loader: join(scriptDir, \"webpack/video-json-loader.js\")\n            }\n          ],\n          type: \"json\"\n        }\n      );\n      if (typeof nextConfig.webpack === \"function\") {\n        return nextConfig.webpack(config, options);\n      }\n      return config;\n    }\n  });\n}\nconst isVersionLessThan = (version, target) => {\n  const parseVersion = (v) => v.split(\".\").map((n) => parseInt(n, 10));\n  const versionParts = parseVersion(version);\n  const targetParts = parseVersion(target);\n  for (let i = 0; i < Math.max(versionParts.length, targetParts.length); i++) {\n    const vPart = versionParts[i] || 0;\n    const tPart = targetParts[i] || 0;\n    if (vPart < tPart) return true;\n    if (vPart > tPart) return false;\n  }\n  return false;\n};\nexport {\n  withNextVideo\n};\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 1976, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/node_modules/next-video/dist/setup-next-video.js"],"sourcesContent":["import { setVideoConfig } from \"./config.js\";\nimport handler, { GET, POST } from \"./request-handler.js\";\nimport { withNextVideo as withNextVideoInternal } from \"./with-next-video.js\";\nfunction NextVideo(config) {\n  setVideoConfig(config);\n  const withNextVideo = (nextConfig) => {\n    return withNextVideoInternal(nextConfig, config);\n  };\n  return {\n    GET,\n    POST,\n    handler,\n    withNextVideo\n  };\n}\nexport {\n  NextVideo\n};\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AACA,SAAS,UAAU,MAAM;IACvB,IAAA,mKAAc,EAAC;IACf,MAAM,gBAAgB,CAAC;QACrB,OAAO,IAAA,iLAAqB,EAAC,YAAY;IAC3C;IACA,OAAO;QACL,KAAA,oKAAG;QACH,MAAA,qKAAI;QACJ,SAAA,wKAAO;QACP;IACF;AACF","ignoreList":[0]}},
    {"offset": {"line": 2003, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/node_modules/next-video/dist/process.js"],"sourcesContent":["import { videoHandler, callHandler } from \"./video-handler.js\";\nimport { uploadLocalFile } from \"./handlers/local-upload.js\";\nimport { uploadRequestedFile } from \"./handlers/api-request.js\";\nimport log from \"./utils/logger.js\";\nimport { NextVideo } from \"./setup-next-video.js\";\nimport { withNextVideo } from \"./with-next-video.js\";\ntry {\n  videoHandler(\"local.video.added\", uploadLocalFile);\n  videoHandler(\"request.video.added\", uploadRequestedFile);\n} catch (err) {\n  log.error(\"An exception occurred within next-video. You may need to restart your dev server.\");\n  console.error(err);\n}\nexport {\n  NextVideo,\n  callHandler,\n  videoHandler,\n  withNextVideo\n};\n"],"names":[],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;AACA,IAAI;IACF,IAAA,2KAAY,EAAC,qBAAqB,yLAAe;IACjD,IAAA,2KAAY,EAAC,uBAAuB,4LAAmB;AACzD,EAAE,OAAO,KAAK;IACZ,qKAAG,CAAC,KAAK,CAAC;IACV,QAAQ,KAAK,CAAC;AAChB","ignoreList":[0]}},
    {"offset": {"line": 2028, "column": 0}, "map": {"version":3,"sources":["file:///D:/the-crimson-archive/node_modules/next-video/dist/request-handler.js"],"sourcesContent":["import { callHandler } from \"./process.js\";\nimport { createAsset, getAsset } from \"./assets.js\";\nimport { getVideoConfig } from \"./config.js\";\nasync function GET(request) {\n  const { searchParams } = new URL(request.url);\n  const url = searchParams.get(\"url\");\n  const { status, data } = await getRequest(url);\n  return Response.json(data, { status });\n}\nasync function POST(request) {\n  const { url } = await request.json();\n  const { status, data } = await postRequest(url);\n  return Response.json(data, { status });\n}\nasync function handler(req, res) {\n  if (req.method === \"POST\") {\n    const { status: status2, data: data2 } = await postRequest(String(req.body.url));\n    res.status(status2).json(data2);\n    return;\n  }\n  const { status, data } = await getRequest(String(req.query.url));\n  res.status(status).json(data);\n}\nasync function getRequest(url) {\n  if (!url) {\n    return {\n      status: 400,\n      data: { error: \"url parameter is required\" }\n    };\n  }\n  let asset;\n  try {\n    asset = await getAsset(url);\n  } catch {\n    const isDevMode = true;\n    if (isDevMode) {\n      asset = await createAsset(url);\n      if (asset) {\n        const videoConfig = await getVideoConfig();\n        await callHandler(\"request.video.added\", asset, videoConfig);\n        return { status: 200, data: asset };\n      } else {\n        return { status: 500, data: { error: \"could not create asset\" } };\n      }\n    }\n    return { status: 404, data: { error: \"asset not found\" } };\n  }\n  return { status: 200, data: asset };\n}\nasync function postRequest(url) {\n  if (!url) {\n    return {\n      status: 400,\n      data: { error: \"url parameter is required\" }\n    };\n  }\n  let asset;\n  try {\n    asset = await createAsset(url);\n    if (!asset) {\n      return { status: 500, data: { error: \"could not create asset\" } };\n    }\n    const videoConfig = await getVideoConfig();\n    await callHandler(\"request.video.added\", asset, videoConfig);\n    return { status: 200, data: asset };\n  } catch {\n    return { status: 500, data: { error: \"could not create asset\" } };\n  }\n}\nexport {\n  GET,\n  POST,\n  handler as default\n};\n"],"names":[],"mappings":";;;;;;;;AAAA;AAAA;AACA;AACA;;;;AACA,eAAe,IAAI,OAAO;IACxB,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;IAC5C,MAAM,MAAM,aAAa,GAAG,CAAC;IAC7B,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,WAAW;IAC1C,OAAO,SAAS,IAAI,CAAC,MAAM;QAAE;IAAO;AACtC;AACA,eAAe,KAAK,OAAO;IACzB,MAAM,EAAE,GAAG,EAAE,GAAG,MAAM,QAAQ,IAAI;IAClC,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,YAAY;IAC3C,OAAO,SAAS,IAAI,CAAC,MAAM;QAAE;IAAO;AACtC;AACA,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC7B,IAAI,IAAI,MAAM,KAAK,QAAQ;QACzB,MAAM,EAAE,QAAQ,OAAO,EAAE,MAAM,KAAK,EAAE,GAAG,MAAM,YAAY,OAAO,IAAI,IAAI,CAAC,GAAG;QAC9E,IAAI,MAAM,CAAC,SAAS,IAAI,CAAC;QACzB;IACF;IACA,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,WAAW,OAAO,IAAI,KAAK,CAAC,GAAG;IAC9D,IAAI,MAAM,CAAC,QAAQ,IAAI,CAAC;AAC1B;AACA,eAAe,WAAW,GAAG;IAC3B,IAAI,CAAC,KAAK;QACR,OAAO;YACL,QAAQ;YACR,MAAM;gBAAE,OAAO;YAA4B;QAC7C;IACF;IACA,IAAI;IACJ,IAAI;QACF,QAAQ,MAAM,IAAA,6JAAQ,EAAC;IACzB,EAAE,OAAM;QACN,MAAM,YAAY;QAClB,wCAAe;YACb,QAAQ,MAAM,IAAA,gKAAW,EAAC;YAC1B,IAAI,OAAO;gBACT,MAAM,cAAc,MAAM,IAAA,mKAAc;gBACxC,MAAM,IAAA,0KAAW,EAAC,uBAAuB,OAAO;gBAChD,OAAO;oBAAE,QAAQ;oBAAK,MAAM;gBAAM;YACpC,OAAO;gBACL,OAAO;oBAAE,QAAQ;oBAAK,MAAM;wBAAE,OAAO;oBAAyB;gBAAE;YAClE;QACF;;;IAEF;IACA,OAAO;QAAE,QAAQ;QAAK,MAAM;IAAM;AACpC;AACA,eAAe,YAAY,GAAG;IAC5B,IAAI,CAAC,KAAK;QACR,OAAO;YACL,QAAQ;YACR,MAAM;gBAAE,OAAO;YAA4B;QAC7C;IACF;IACA,IAAI;IACJ,IAAI;QACF,QAAQ,MAAM,IAAA,gKAAW,EAAC;QAC1B,IAAI,CAAC,OAAO;YACV,OAAO;gBAAE,QAAQ;gBAAK,MAAM;oBAAE,OAAO;gBAAyB;YAAE;QAClE;QACA,MAAM,cAAc,MAAM,IAAA,mKAAc;QACxC,MAAM,IAAA,0KAAW,EAAC,uBAAuB,OAAO;QAChD,OAAO;YAAE,QAAQ;YAAK,MAAM;QAAM;IACpC,EAAE,OAAM;QACN,OAAO;YAAE,QAAQ;YAAK,MAAM;gBAAE,OAAO;YAAyB;QAAE;IAClE;AACF","ignoreList":[0]}}]
}